<!DOCTYPE html>
<html><head><meta charset="UTF-8"><link href="css/default.css" rel="stylesheet" type="text/css"><script src="js/jquery.min.js" type="text/javascript"></script><script src="js/page_effects.js" type="text/javascript"></script><title>Immutant 2.1.5 API documentation</title><link href="assets/immutant.css" rel="stylesheet" type="text/css"></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a></h2><h1><a href="index.html">Immutant 2.1.5 API documentation</a></h1></div><div class="sidebar" id="namespaces"><div id="guides"><h3><a href="index.html"><span class="inner">Guides</span></a></h3><ul><li class="guide Migration-current"><a href="guide-migration.html"><div class="inner"><span>Migration</span></div></a></li><li class="guide Installation-current"><a href="guide-installation.html"><div class="inner"><span>Installation</span></div></a></li><li class="guide Web-current"><a href="guide-web.html"><div class="inner"><span>Web</span></div></a></li><li class="guide Messaging-current"><a href="guide-messaging.html"><div class="inner"><span>Messaging</span></div></a></li><li class="guide Scheduling-current"><a href="guide-scheduling.html"><div class="inner"><span>Scheduling</span></div></a></li><li class="guide Caching-current"><a href="guide-caching.html"><div class="inner"><span>Caching</span></div></a></li><li class="guide Transactions-current"><a href="guide-transactions.html"><div class="inner"><span>Transactions</span></div></a></li><li class="guide WildFly-current"><a href="guide-wildfly.html"><div class="inner"><span>WildFly</span></div></a></li><li class="guide EAP 6.4.x-current"><a href="guide-EAP.html"><div class="inner"><span>EAP 6.4.x</span></div></a></li><li class="guide current"><a href="guide-logging.html"><div class="inner"><span>Logging</span></div></a></li></ul></div><h3><a href="index.html"><span class="inner">Namespaces</span></a></h3><ul><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>immutant</span></div></div></li><li class="depth-2"><a href="immutant.caching.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>caching</span></div></a></li><li class="depth-3 branch"><a href="immutant.caching.core-cache.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>core-cache</span></div></a></li><li class="depth-3"><a href="immutant.caching.core-memoize.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>core-memoize</span></div></a></li><li class="depth-2"><a href="immutant.codecs.html"><div class="inner"><span class="tree" style="top: -83px;"><span class="top" style="height: 92px;"></span><span class="bottom"></span></span><span>codecs</span></div></a></li><li class="depth-3"><a href="immutant.codecs.fressian.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>fressian</span></div></a></li><li class="depth-2 branch"><a href="immutant.coercions.html"><div class="inner"><span class="tree" style="top: -52px;"><span class="top" style="height: 61px;"></span><span class="bottom"></span></span><span>coercions</span></div></a></li><li class="depth-2 branch"><a href="immutant.daemons.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>daemons</span></div></a></li><li class="depth-2"><a href="immutant.messaging.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>messaging</span></div></a></li><li class="depth-3 branch"><a href="immutant.messaging.hornetq.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>hornetq</span></div></a></li><li class="depth-3"><a href="immutant.messaging.pipeline.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>pipeline</span></div></a></li><li class="depth-2"><a href="immutant.scheduling.html"><div class="inner"><span class="tree" style="top: -83px;"><span class="top" style="height: 92px;"></span><span class="bottom"></span></span><span>scheduling</span></div></a></li><li class="depth-3 branch"><a href="immutant.scheduling.joda.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>joda</span></div></a></li><li class="depth-3"><a href="immutant.scheduling.quartz.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>quartz</span></div></a></li><li class="depth-2"><a href="immutant.transactions.html"><div class="inner"><span class="tree" style="top: -83px;"><span class="top" style="height: 92px;"></span><span class="bottom"></span></span><span>transactions</span></div></a></li><li class="depth-3 branch"><a href="immutant.transactions.jdbc.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>jdbc</span></div></a></li><li class="depth-3"><a href="immutant.transactions.scope.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>scope</span></div></a></li><li class="depth-2 branch"><a href="immutant.util.html"><div class="inner"><span class="tree" style="top: -83px;"><span class="top" style="height: 92px;"></span><span class="bottom"></span></span><span>util</span></div></a></li><li class="depth-2"><a href="immutant.web.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>web</span></div></a></li><li class="depth-3 branch"><a href="immutant.web.async.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>async</span></div></a></li><li class="depth-3 branch"><a href="immutant.web.middleware.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>middleware</span></div></a></li><li class="depth-3 branch"><a href="immutant.web.sse.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>sse</span></div></a></li><li class="depth-3 branch"><a href="immutant.web.ssl.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>ssl</span></div></a></li><li class="depth-3"><a href="immutant.web.undertow.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>undertow</span></div></a></li><li class="depth-2"><a href="immutant.wildfly.html"><div class="inner"><span class="tree" style="top: -176px;"><span class="top" style="height: 185px;"></span><span class="bottom"></span></span><span>wildfly</span></div></a></li></ul></div><div class='namespace-index guide' id='content'><div class='markdown doc'><div class="guide-content"><h1>Logging Guide</h1><div class="description"><span>Details about how logging with Immutant works, along with how to change it</span></div><div id="toc"><ul><li><a href="#h5378"><span>Logging when outside of WildFly</span></a><ul><li><a href="#h5379"><span>The default Logback configuration</span></a></li><li><a href="#h5380"><span>Overriding the default configuration</span></a></li><li><a href="#h5381"><span>Replacing Logback</span></a></li></ul></li><li><a href="#h5382"><span>Logging when inside WildFly</span></a><ul><li><a href="#h5383"><span>Modifying the WildFly logging configuration</span></a></li><li><a href="#h5384"><span>Disabling the logging subsystem in WildFly</span></a></li></ul></li></ul></div><p>Logging with Java is a many-headed beast, and the behavior and configuration of logging for an Immutant-based application depends on how you run it. When an application is launched outside of a <a href="http://wildfly.org/">WildFly</a> container, using and configuring logging is fairly straightforward. Inside of WildFly, there are a few hoops you&rsquo;ll have to jump through if you can&rsquo;t use the default logging configuration.</p><h2 id="h5378">Logging when outside of WildFly</h2><p>When used outside of WildFly, Immutant uses <a href="http://slf4j.org/">SLF4J</a> and <a href="http://logback.qos.ch/">Logback</a> for logging by default. Any log messages that Immutant itself generates will be handled by Logback, as will anything your app logs via <a href="https://github.com/clojure/tools.logging">clojure.tools.logging</a> (or <a href="https://github.com/ptaoussanis/timbre">Timbre</a>, if you configure it to delegate to clojure.tools.logging).</p><p>You can adjust the root logging level at runtime by calling <a href="immutant.util.html#var-set-log-level.21">immutant.util/set-log-level!</a>. <strong>Note</strong>: this will only work if Logback is actually being used, and not replaced with another implementation as we discuss below.</p><p>If the default logging configuration doesn&rsquo;t meet your needs, you can provide an alternate Logback configuration, or replace Logback with some other SLF4J provider.</p><h3 id="h5379">The default Logback configuration</h3><p>By default, Logback is configured to log at <code>INFO</code> and below to the console, with some of the chattier libraries we bring in configured at <code>WARN</code> and below. The output looks like:</p>
<pre><code>23:58:53.313 INFO  [my-app.core] (main) an info message
23:58:53.313 WARN  [my-app.core] (main) a warning message
23:58:53.313 ERROR [my-app.core] (main) an error message
23:58:53.450 INFO  [org.projectodd.wunderboss.web.Web] (main) Registered web context /
</code></pre><p>The <a href="https://github.com/projectodd/wunderboss/blob/0.12.2/core/src/main/resources/logback-default.xml">default configuration</a> is only applied when Logback is available and you don&rsquo;t provide an overriding configuration in your application.</p><h3 id="h5380">Overriding the default configuration</h3><p>If you want a different format for your log messages, or perhaps send them to a file, or configure any of the other <a href="http://logback.qos.ch/manual/index.html">myriad options</a>, you can either provide a <a href="http://logback.qos.ch/manual/configuration.html">logback.xml</a> file on the classpath of your app (e.g. inside <code>resources/</code>), or set the <code>logback.configurationFile</code> system property to the path of the file or resource if you&rsquo;re using something other than <code>logback.xml</code>.</p><p>When defining a custom configuration, it may be useful to use the <a href="https://github.com/projectodd/wunderboss/blob/0.12.2/core/src/main/resources/logback-default.xml">default configuration</a> as a starting point.</p><h3 id="h5381">Replacing Logback</h3><p>If you want to use a logging implementation other than Logback, you&rsquo;ll need to exclude Logback and bring in your preferred implementation along with the related SLF4J bridge. For example, to use <a href="http://logging.apache.org/log4j/2.x/">Log4j</a>, you can modify your <code>:dependencies</code> like so:</p>
<pre><code class="clojure"><br/>  :dependencies [...
                 [org.immutant/immutant &quot;2.1.5&quot;
                   :exclusions [ch.qos.logback/logback-classic]]
                 [org.apache.logging.log4j/log4j-core &quot;2.0.2&quot;]
                 [org.apache.logging.log4j/log4j-slf4j-impl &quot;2.0.2&quot;]]
</code></pre><p>For more information on using other logging implementations with SLF4J, see the <a href="http://www.slf4j.org/manual.html#swapping">SLF4J manual</a>.</p><h2 id="h5382">Logging when inside WildFly</h2><p>When used inside of WildFly, jboss-logging is activated and replaces Logback as the logging implementation. The default configuration for it produces output that is very similar to the default Logback output above, and it is written to the console and to <code>$WILDFLY_HOME/standalone/log/server.log</code>. Any log messages that Immutant itself generates will be handled by jboss-logging, as will anything your app logs via <a href="https://github.com/clojure/tools.logging">clojure.tools.logging</a> (or <a href="https://github.com/ptaoussanis/timbre">Timbre</a>, if you configure it to delegate to clojure.tools.logging), or writes to stdout/stderr.</p><p>If you need to alter the default logging configuration, you have three options:</p>
<ul>
  <li>Modify the logging configuration in WildFly&rsquo;s <code>standalone-*.xml</code> files.</li>
  <li>Disable the logging subsystem, which re-enables Logback, and provide  a custom <code>logback.xml</code>.</li>
  <li>Disable the logging subsystem <em>and</em> Logback, and bring in a  different SLF4J logging implementation.</li>
</ul><h3 id="h5383">Modifying the WildFly logging configuration</h3><p>WildFly provides a very sophisticated logging system that nobody completely understands. It&rsquo;s possible to configure hierarchical, categorized log message routing, complex file rotation, syslog integration, SMTP notifications, SNMP traps, JMS, JMX and much more. Obviously, most of that is far beyond the scope of this document. Instead, we refer you to the WildFly <a href="https://docs.jboss.org/author/display/WFLY8/Logging+Configuration">logging documentation</a>.</p><h3 id="h5384">Disabling the logging subsystem in WildFly</h3><p>In order disable the logging subsystem in WildFly, you&rsquo;ll need to do a little bit of work.</p><p>First, you&rsquo;ll need to modify the <code>jboss-deployment-structure.xml</code> file that gets placed in the war&rsquo;s <code>WEB-INF/</code> directory. To get it, run:</p>
<pre><code>lein immutant war
</code></pre><p>In addition to generating a war file, this also dumps a copy of the default <code>jboss-deployment-structure.xml</code> to <code>target/</code>. Grab that and copy it to <code>war-resources/WEB-INF/</code> in the root of your application. Then, add the following to it:</p>
<pre><code>&lt;exclude-subsystems&gt;
  &lt;subsystem name=&quot;logging&quot; /&gt;
&lt;/exclude-subsystems&gt;
</code></pre><p>Second, in order for your custom resources to be included in the war file, you&rsquo;ll need to add the following to your <code>project.clj</code>:</p>
<pre><code class="clojure">  :immutant {:war {:resource-paths [&quot;war-resources&quot;]}}
</code></pre><p>Once you disable the logging subsystem, you can now provide a custom <code>logback.xml</code> as we discussed above, with one important difference - the <code>logback.xml</code> must reside in the war file instead of simply on the application&rsquo;s classpath. Therefore, you&rsquo;ll need to put your <code>logback.xml</code> in <code>war-resources/WEB-INF/lib/</code>.</p><p>You can also still provide an alternate SLF4J implementation as we did above, but any configuration for it (<code>log4j.xml</code>, etc.), will need to be in <code>war-resources/WEB-INF/lib</code> as well.</p><p>Now, regenerate your war file, and you should be good to go. For more information on running your application in WildFly, see our <a href="guide-wildfly.html">WildFly guide</a>.</p></div></div></div><script src="assets/jquery.syntax.min.js" type="text/javascript"></script><script src="assets/immutant.js" type="text/javascript"></script></body></html>