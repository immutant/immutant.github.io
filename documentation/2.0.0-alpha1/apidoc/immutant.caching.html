<!DOCTYPE html>
<html><head><meta charset="UTF-8"><link href="css/default.css" rel="stylesheet" type="text/css"><link href="css/docs.css" rel="stylesheet" type="text/css"><script src="js/jquery.min.js" type="text/javascript"></script><script src="js/page_effects.js" type="text/javascript"></script><title>immutant.caching documentation</title></head><body><div id="header"><h2><a href="/">Immutant Home</a></h2><h1><a href="index.html">Immutant 2.0.0-alpha1</a></h1></div><div class="sidebar" id="namespaces"><h3><a href="index.html"><span class="inner">Namespaces</span></a></h3><ul><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>immutant</span></div></div></li><li class="depth-2 current"><a href="immutant.caching.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>caching</span></div></a></li><li class="depth-3 branch"><a href="immutant.caching.core-cache.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>core-cache</span></div></a></li><li class="depth-3"><a href="immutant.caching.core-memoize.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>core-memoize</span></div></a></li><li class="depth-2 branch"><a href="immutant.codecs.html"><div class="inner"><span class="tree" style="top: -83px;"><span class="top" style="height: 92px;"></span><span class="bottom"></span></span><span>codecs</span></div></a></li><li class="depth-2 branch"><a href="immutant.coercions.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>coercions</span></div></a></li><li class="depth-2 branch"><a href="immutant.daemons.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>daemons</span></div></a></li><li class="depth-2"><a href="immutant.messaging.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>messaging</span></div></a></li><li class="depth-3 branch"><a href="immutant.messaging.hornetq.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>hornetq</span></div></a></li><li class="depth-3"><a href="immutant.messaging.pipeline.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>pipeline</span></div></a></li><li class="depth-2"><a href="immutant.scheduling.html"><div class="inner"><span class="tree" style="top: -83px;"><span class="top" style="height: 92px;"></span><span class="bottom"></span></span><span>scheduling</span></div></a></li><li class="depth-3"><a href="immutant.scheduling.joda.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>joda</span></div></a></li><li class="depth-2 branch"><a href="immutant.util.html"><div class="inner"><span class="tree" style="top: -52px;"><span class="top" style="height: 61px;"></span><span class="bottom"></span></span><span>util</span></div></a></li><li class="depth-2"><a href="immutant.web.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>web</span></div></a></li><li class="depth-3 branch"><a href="immutant.web.middleware.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>middleware</span></div></a></li><li class="depth-3 branch"><a href="immutant.web.undertow.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>undertow</span></div></a></li><li class="depth-3"><a href="immutant.web.websocket.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>websocket</span></div></a></li><li class="depth-2"><a href="immutant.wildfly.html"><div class="inner"><span class="tree" style="top: -114px;"><span class="top" style="height: 123px;"></span><span class="bottom"></span></span><span>wildfly</span></div></a></li></ul></div><div class="sidebar" id="vars"><h3><a href="#top"><span class="inner">Public Vars</span></a></h3><ul><li class="depth-1"><a href="immutant.caching.html#var-builder"><div class="inner"><span>builder</span></div></a></li><li class="depth-1"><a href="immutant.caching.html#var-cache"><div class="inner"><span>cache</span></div></a></li><li class="depth-1"><a href="immutant.caching.html#var-compare-and-swap.21"><div class="inner"><span>compare-and-swap!</span></div></a></li><li class="depth-1"><a href="immutant.caching.html#var-exists.3F"><div class="inner"><span>exists?</span></div></a></li><li class="depth-1"><a href="immutant.caching.html#var-stop"><div class="inner"><span>stop</span></div></a></li><li class="depth-1"><a href="immutant.caching.html#var-with-codec"><div class="inner"><span>with-codec</span></div></a></li><li class="depth-1"><a href="immutant.caching.html#var-with-expiration"><div class="inner"><span>with-expiration</span></div></a></li></ul></div><div class="namespace-docs" id="content"><h2 class="anchor" id="top">immutant.caching</h2><div class="doc"><p>Create, manage and manipulate <a href='http://infinispan.org'>Infinispan</a> caches in a data grid</p></div><div class="public anchor" id="var-builder"><h3>builder</h3><div class="usage"><code>(builder &amp; options)</code></div><div class="doc"><p>For advanced use, call this function to obtain a "fluent" <a href='https://docs.jboss.org/infinispan/6.0/apidocs/org/infinispan/configuration/cache/ConfigurationBuilder.html'>ConfigurationBuilder</a>. Set the desired options, and invoke its build method, the result from which can be passed via the <code>:configuration</code> option of the <code><a href="immutant.caching.html#var-cache">cache</a></code> function. For example:</p><pre>
&#40;let &#91;config &#40;.. &#40;builder <code>:ttl</code> &#91;30 <code>:minutes</code>&#93;&#41;
                clustering l1 &#40;enabled true&#41; build&#41;&#93;
  &#40;cache &quot;L1&quot; <code>:configuration</code> config&#41;&#41;
</pre><p>Note that builder takes the same options as <code><a href="immutant.caching.html#var-cache">cache</a></code> so you can concisely initialize it with Clojure, and use Java interop to set the more esoteric options</p></div><div class="src-link"><a href="https://github.com/immutant/immutant/tree/2.0.0-alpha1/caching/src/immutant/caching.clj#L176">view source</a></div></div><div class="public anchor" id="var-cache"><h3>cache</h3><div class="usage"><code>(cache name)</code><code>(cache name k v &amp; kvs)</code><code>(cache name opts)</code></div><div class="doc"><p>Returns an <a href='https://docs.jboss.org/infinispan/6.0/apidocs/org/infinispan/Cache.html'>org.infinispan.Cache</a>, an extension of <code>java.util.concurrent.ConcurrentMap</code>. A name is the only required argument. If a cache by that name already exists, it will be returned, and any options passed to this function will be ignored. To force reconfiguration, call <code><a href="immutant.caching.html#var-stop">stop</a></code> before calling <code><a href="immutant.caching.html#var-cache">cache</a></code>.</p><p>The following groups of options are supported, each listed with its [default] value. A negative value for any numeric option means "unlimited".</p><p>Durability: entries can persist to disk via the <code>:persist</code> option. If set to <code>true</code>, cache entries will persist in the current directory. Override this by setting <code>:persist</code> to a string naming the desired directory.</p><ul><li><code>:persist</code> - if non-nil, data persists across server restarts in a             file store; a string value names the directory <em>[nil]</em></li></ul><p>Eviction: turned off by default, <code>:max-entries</code> may be set to mitigate the risk of memory exhaustion. When <code>:persist</code> is enabled, evicted entries are written to disk, so that the entries in memory are a subset of those in the file store, transparently reloaded upon request. The eviction policy may be one of <code>:none</code>, <code>:lru</code>, <code>:lirs</code>, or <code>:unordered</code></p><ul><li><code>:max-entries</code> - the max number of entries allowed in the cache <em>[-1]</em></li><li><code>:eviction</code> - how entries are evicted when <code>:max-entries</code> is exceeded <em>[<code>:none</code>]</em></li></ul><p>Expiration: both time-to-live and max idle limits are supported. Values may be a number of milliseconds, a period keyword, or multiplier/keyword pairs, e.g. <code>&#91;1 <code>:hour</code> 20 <code>:minutes</code>&#93;</code>. Both singular and plural versions of <code>:second</code>, <code>:minute</code>, <code>:hour</code>, <code>:day</code>, and <code>:week</code> are valid period keywords.</p><ul><li><code>:ttl</code> - the max time the entry will live before expiry <em>[-1]</em></li><li><code>:idle</code> - the time after which an entry will expire if not accessed <em>[-1]</em></li></ul><p>Replication: the replication mode defaults to <code>:dist-sync</code> when clustered. When not clustered, the value of <code>:mode</code> is ignored, and the cache will be <code>:local</code>. Asynchronous replication may yield a slight performance increase at the risk of potential cache inconsistency.</p><ul><li><code>:mode</code> - replication mode [<code>:dist-sync</code> or <code>:local</code>] one of <code>:local</code>,          <code>:repl-sync</code>, <code>:repl-async</code>, <code>:invalidation-sync</code>,          <code>:invalidation-async</code>, <code>:dist-sync</code>, <code>:dist-async</code></li></ul><p>Transactions: caches can participate in transactions when a TransactionManager is available. The locking scheme may be either <code>:optimisitic</code> or <code>:pessimistic</code></p><ul><li><code>:transactional</code> - whether the cache is transactional <em>[false]</em></li><li><code>:locking</code> - transactional locking scheme <em>[<code>:optimistic</code>]</em></li></ul><p>Advanced configuration: the options listed above are the most commonly configured, but Infinispan has many more buttons, switches, dials, knobs and levers. Call the <code><a href="immutant.caching.html#var-builder">builder</a></code> function to create your own Configuration instance and pass it in via the <code>:configuration</code> option.</p><ul><li><code>:configuration</code> - a <a href='https://docs.jboss.org/infinispan/6.0/apidocs/org/infinispan/configuration/cache/Configuration.html'>Configuration</a> instance</li></ul></div><div class="src-link"><a href="https://github.com/immutant/immutant/tree/2.0.0-alpha1/caching/src/immutant/caching.clj#L28">view source</a></div></div><div class="public anchor" id="var-compare-and-swap.21"><h3>compare-and-swap!</h3><div class="usage"><code>(compare-and-swap! cache key f &amp; args)</code></div><div class="doc"><p>Atomically swaps the value associated to the key in the cache with the result of applying f, passing the current value as the first param along with any args, returning the new cached value. Function f should have no side effects, as it may be called multiple times. If the key is missing, the result of applying f to nil will be inserted atomically.</p></div><div class="src-link"><a href="https://github.com/immutant/immutant/tree/2.0.0-alpha1/caching/src/immutant/caching.clj#L145">view source</a></div></div><div class="public anchor" id="var-exists.3F"><h3>exists?</h3><div class="usage"><code>(exists? name)</code></div><div class="doc"><p>Return true if the named cache exists</p></div><div class="src-link"><a href="https://github.com/immutant/immutant/tree/2.0.0-alpha1/caching/src/immutant/caching.clj#L163">view source</a></div></div><div class="public anchor" id="var-stop"><h3>stop</h3><div class="usage"><code>(stop cache-or-name)</code></div><div class="doc"><p>Removes a cache, allowing it to be reconfigured by the <code><a href="immutant.caching.html#var-cache">cache</a></code> function.</p></div><div class="src-link"><a href="https://github.com/immutant/immutant/tree/2.0.0-alpha1/caching/src/immutant/caching.clj#L168">view source</a></div></div><div class="public anchor" id="var-with-codec"><h3>with-codec</h3><div class="usage"><code>(with-codec cache codec)</code></div><div class="doc"><p>Takes a cache and a keyword denoting a codec, and returns a new cache that applies that codec as entries are accessed in the passed cache. This is typically necessary only when non-clojure clients are sharing the cache. It's required if you wish to store nil keys or values. The following codecs are supported: <code>:edn</code>, <code>:json</code>, and <code>:fressian</code>. The latter two require additional dependencies: <code>cheshire</code> and <code>org.clojure/data.fressian</code>, respectively.</p></div><div class="src-link"><a href="https://github.com/immutant/immutant/tree/2.0.0-alpha1/caching/src/immutant/caching.clj#L106">view source</a></div></div><div class="public anchor" id="var-with-expiration"><h3>with-expiration</h3><div class="usage"><code>(with-expiration cache &amp; options)</code></div><div class="doc"><p>Returns a cache that will delegate any writes to the passed cache according to these options:</p><ul><li><code>:ttl</code> - the max time the entry will live before expiry <em>[-1]</em></li><li><code>:idle</code> - the time after which an entry will expire if not accessed <em>[-1]</em></li></ul><p>Options may be passed as either keyword arguments or in a map.</p><p>Negative values imply "unlimited". Values may be a number of milliseconds, a period keyword, or multiplier/keyword pairs, e.g. <code>&#91;1 <code>:hour</code> 20 <code>:minutes</code>&#93;</code>. Both singular and plural versions of <code>:second</code>, <code>:minute</code>, <code>:hour</code>, <code>:day</code>, and <code>:week</code> are valid period keywords.</p><p>Expiration for existing entries in the passed cache will not be affected.</p></div><div class="src-link"><a href="https://github.com/immutant/immutant/tree/2.0.0-alpha1/caching/src/immutant/caching.clj#L119">view source</a></div></div></div></body></html>