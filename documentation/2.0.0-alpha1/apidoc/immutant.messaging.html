<!DOCTYPE html>
<html><head><meta charset="UTF-8"><link href="css/default.css" rel="stylesheet" type="text/css"><link href="css/docs.css" rel="stylesheet" type="text/css"><script src="js/jquery.min.js" type="text/javascript"></script><script src="js/page_effects.js" type="text/javascript"></script><title>immutant.messaging documentation</title></head><body><div id="header"><h2><a href="http://immutant.org/">Immutant Home</a></h2><h1><a href="index.html">Immutant 2.0.0-alpha1</a></h1></div><div class="sidebar" id="namespaces"><h3><a href="index.html"><span class="inner">Namespaces</span></a></h3><ul><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>immutant</span></div></div></li><li class="depth-2"><a href="immutant.caching.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>caching</span></div></a></li><li class="depth-3 branch"><a href="immutant.caching.core-cache.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>core-cache</span></div></a></li><li class="depth-3"><a href="immutant.caching.core-memoize.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>core-memoize</span></div></a></li><li class="depth-2 branch"><a href="immutant.codecs.html"><div class="inner"><span class="tree" style="top: -83px;"><span class="top" style="height: 92px;"></span><span class="bottom"></span></span><span>codecs</span></div></a></li><li class="depth-2 branch"><a href="immutant.coercions.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>coercions</span></div></a></li><li class="depth-2 branch"><a href="immutant.daemons.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>daemons</span></div></a></li><li class="depth-2 current"><a href="immutant.messaging.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>messaging</span></div></a></li><li class="depth-3 branch"><a href="immutant.messaging.hornetq.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>hornetq</span></div></a></li><li class="depth-3"><a href="immutant.messaging.pipeline.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>pipeline</span></div></a></li><li class="depth-2"><a href="immutant.scheduling.html"><div class="inner"><span class="tree" style="top: -83px;"><span class="top" style="height: 92px;"></span><span class="bottom"></span></span><span>scheduling</span></div></a></li><li class="depth-3"><a href="immutant.scheduling.joda.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>joda</span></div></a></li><li class="depth-2 branch"><a href="immutant.util.html"><div class="inner"><span class="tree" style="top: -52px;"><span class="top" style="height: 61px;"></span><span class="bottom"></span></span><span>util</span></div></a></li><li class="depth-2"><a href="immutant.web.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>web</span></div></a></li><li class="depth-3 branch"><a href="immutant.web.middleware.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>middleware</span></div></a></li><li class="depth-3 branch"><a href="immutant.web.undertow.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>undertow</span></div></a></li><li class="depth-3"><a href="immutant.web.websocket.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>websocket</span></div></a></li><li class="depth-2"><a href="immutant.wildfly.html"><div class="inner"><span class="tree" style="top: -114px;"><span class="top" style="height: 123px;"></span><span class="bottom"></span></span><span>wildfly</span></div></a></li></ul></div><div class="sidebar" id="vars"><h3><a href="#top"><span class="inner">Public Vars</span></a></h3><ul><li class="depth-1"><a href="immutant.messaging.html#var-connection"><div class="inner"><span>connection</span></div></a></li><li class="depth-1"><a href="immutant.messaging.html#var-listen"><div class="inner"><span>listen</span></div></a></li><li class="depth-1"><a href="immutant.messaging.html#var-publish"><div class="inner"><span>publish</span></div></a></li><li class="depth-1"><a href="immutant.messaging.html#var-queue"><div class="inner"><span>queue</span></div></a></li><li class="depth-1"><a href="immutant.messaging.html#var-receive"><div class="inner"><span>receive</span></div></a></li><li class="depth-1"><a href="immutant.messaging.html#var-request"><div class="inner"><span>request</span></div></a></li><li class="depth-1"><a href="immutant.messaging.html#var-respond"><div class="inner"><span>respond</span></div></a></li><li class="depth-1"><a href="immutant.messaging.html#var-session"><div class="inner"><span>session</span></div></a></li><li class="depth-1"><a href="immutant.messaging.html#var-stop"><div class="inner"><span>stop</span></div></a></li><li class="depth-1"><a href="immutant.messaging.html#var-subscribe"><div class="inner"><span>subscribe</span></div></a></li><li class="depth-1"><a href="immutant.messaging.html#var-topic"><div class="inner"><span>topic</span></div></a></li><li class="depth-1"><a href="immutant.messaging.html#var-unsubscribe"><div class="inner"><span>unsubscribe</span></div></a></li></ul></div><div class="namespace-docs" id="content"><h2 class="anchor" id="top">immutant.messaging</h2><div class="doc"><p>Easily publish and receive messages containing any type of nested data structure to dynamically-created queues and topics.</p></div><div class="public anchor" id="var-connection"><h3>connection</h3><div class="usage"><code>(connection &amp; options)</code></div><div class="doc"><p>Creates a connection to the messaging broker.</p><p>You are responsible for closing any connection created via this function.</p><p>Options that apply to both local and remote connections are <em>[default]</em>:</p><ul><li><code>:client-id</code> - identifies the client id for use with a durable topic subscriber <em>[nil]</em></li></ul><p>Options that apply to only remote connections are <em>[default]</em>:</p><ul><li><code>:host</code> - the host of a remote broker <em>[nil]</em></li><li><code>:port</code> - the port of a remote broker <em>[nil, 5445 if <code>:host</code> provided]</em></li><li><code>:username</code> - a username for the remote broker <em>[nil]</em></li><li><code>:password</code> - the corresponding password for <code>:username</code> <em>[nil]</em></li><li><code>:remote-type</code> - when connecting to a HornetQ instance running                 inside WildFly, this needs to be set to                 <code>:hornetq-wildfly</code> <em>[<code>:hornetq-standalone</code>]</em></li><li><code>:reconnect-attempts</code> - total number of reconnect attempts to make                        before giving up (-1 for unlimited) <em>[0]</em></li><li><code>:reconnect-retry-interval</code> - the period in milliseconds between subsequent                              reconnection attempts <em>[2000]</em></li><li><code>:reconnect-max-retry-interval</code> - the max retry interval that will be used <em>[2000]</em></li><li><code>:reconnect-retry-interval-multiplier</code> - a multiplier to apply to the time                                         since the last retry to compute the                                         time to the next retry <em>[1.0]</em></li></ul></div><div class="src-link"><a href="https://github.com/immutant/immutant/tree/2.0.0-alpha1/messaging/src/immutant/messaging.clj#L84">view source</a></div></div><div class="public anchor" id="var-listen"><h3>listen</h3><div class="usage"><code>(listen destination f &amp; options)</code></div><div class="doc"><p>Registers <code>f</code> to receive each message sent to <code>destination</code>.</p><p>If a <code>:selector</code> is provided, then only messages having metadata/properties matching that expression will be received.</p><p>If no connection is provided, the default shared connection is used.</p><p>The following options are supported <em>[default]</em>:</p><ul><li><code>:concurrency</code>  - the number of threads handling messages <em>[1]</em></li><li><code>:selector</code>     - A JMS (SQL 92) expression matching message metadata/properties <em>[nil]</em></li><li><code>:decode?</code>      - if true, the decoded message body is passed to <code>f</code>. Otherwise, the                    base message object is passed <em>[true]</em></li><li><code>:connection</code>   - a connection to use; caller expected to close <em>[nil]</em></li></ul><p>Returns a listener object that can be stopped by passing it to <code><a href="immutant.messaging.html#var-stop">stop</a></code>, or by calling .close on it.</p></div><div class="src-link"><a href="https://github.com/immutant/immutant/tree/2.0.0-alpha1/messaging/src/immutant/messaging.clj#L227">view source</a></div></div><div class="public anchor" id="var-publish"><h3>publish</h3><div class="usage"><code>(publish destination message &amp; options)</code></div><div class="doc"><p>Send a message to a destination.</p><p>If <code>message</code> has metadata, it will be transferred as headers and reconstituted upon receipt. Metadata keys must be valid Java identifiers (because they can be used in selectors) and can be overridden using the <code>:properties</code> option.</p><p>If no connection is provided, the default shared connection is used. If no session is provided, a new one is opened and closed.</p><p>The following options are supported <em>[default]</em>:</p><ul><li><code>:encoding</code>   - one of: <code>:edn</code>, <code>:fressian</code>, <code>:json</code>, <code>:none</code> <em>[<code>:edn</code>]</em></li><li><code>:priority</code>   - 0-9, or one of: <code>:low</code>, <code>:normal</code>, <code>:high</code>, <code>:critical</code> <em>[4]</em></li><li><code>:ttl</code>        - time to live, in millis <em>[0 (forever)]</em></li><li><code>:persistent</code> - whether undelivered messages survive restarts <em>[true]</em></li><li><code>:properties</code> - a map to which selectors may be applied, overrides metadata <em>[nil]</em></li><li><code>:connection</code> - a connection to use; caller expected to close <em>[nil]</em></li><li><code>:session</code>    - a session to use; caller expected to close <em>[nil]</em></li></ul></div><div class="src-link"><a href="https://github.com/immutant/immutant/tree/2.0.0-alpha1/messaging/src/immutant/messaging.clj#L152">view source</a></div></div><div class="public anchor" id="var-queue"><h3>queue</h3><div class="usage"><code>(queue queue-name &amp; options)</code></div><div class="doc"><p>Establishes a handle to a messaging queue.</p><p>The following options are supported <em>[default]</em>:</p><ul><li><code>:connection</code> - a connection to a remote broker <em>[nil]</em></li><li><code>:durable?</code>   - whether messages persist across restarts <em>[true]</em></li><li><code>:selector</code>   - a JMS (SQL 92) expression to filter published messages <em>[nil]</em></li></ul><p>If given a <code>:connection</code>, the connection is remembered and used as a default option to any fn that takes a queue and a connection.</p><p>This creates the queue if no <code>:connection</code> is provided and it does not yet exist.</p></div><div class="src-link"><a href="https://github.com/immutant/immutant/tree/2.0.0-alpha1/messaging/src/immutant/messaging.clj#L34">view source</a></div></div><div class="public anchor" id="var-receive"><h3>receive</h3><div class="usage"><code>(receive destination &amp; options)</code></div><div class="doc"><p>Receive a message from <code>destination</code>.</p><p>If a <code>:selector</code> is provided, then only messages having metadata/properties matching that expression may be received.</p><p>If no connection is provided, the default shared connection is used. If no session is provided, a new one is opened and closed.</p><p>The following options are supported <em>[default]</em>:</p><ul><li><code>:timeout</code>      - time in millis, after which the timeout-val is returned. 0                    means wait forever, -1 means don't wait at all <em>[10000]</em></li><li><code>:timeout-val</code>  - the value to return when a timeout occurs. Also returned when                    a timeout of -1 is specified, and no message is available <em>[nil]</em></li><li><code>:selector</code>     - A JMS (SQL 92) expression matching message metadata/properties <em>[nil]</em></li><li><code>:decode?</code>      - if true, the decoded message body is returned. Otherwise, the                    base message object is returned <em>[true]</em></li><li><code>:connection</code>   - a connection to use; caller expected to close <em>[nil]</em></li><li><code>:session</code>      - a session to use; caller expected to close <em>[nil]</em></li></ul></div><div class="src-link"><a href="https://github.com/immutant/immutant/tree/2.0.0-alpha1/messaging/src/immutant/messaging.clj#L188">view source</a></div></div><div class="public anchor" id="var-request"><h3>request</h3><div class="usage"><code>(request queue message &amp; options)</code></div><div class="doc"><p>Send <code>message</code> to <code>queue</code> and return a Future that will retrieve the response.</p><p>Implements the request-response pattern, and is used in conjunction with <code><a href="immutant.messaging.html#var-respond">respond</a></code>.</p><p>It takes the same options as <code><a href="immutant.messaging.html#var-publish">publish</a></code>.</p></div><div class="src-link"><a href="https://github.com/immutant/immutant/tree/2.0.0-alpha1/messaging/src/immutant/messaging.clj#L259">view source</a></div></div><div class="public anchor" id="var-respond"><h3>respond</h3><div class="usage"><code>(respond queue f &amp; options)</code></div><div class="doc"><p>Listen for messages on <code>queue</code> sent by the <code><a href="immutant.messaging.html#var-request">request</a></code> function and respond with the result of applying <code>f</code> to the message.</p><p>Accepts the same options as <code><a href="immutant.messaging.html#var-listen">listen</a></code>, along with <em>[default]</em>:</p><ul><li><code>:ttl</code>  - time for the response mesage to live, in millis <em>[60000 (1 minute)]</em></li></ul></div><div class="src-link"><a href="https://github.com/immutant/immutant/tree/2.0.0-alpha1/messaging/src/immutant/messaging.clj#L281">view source</a></div></div><div class="public anchor" id="var-session"><h3>session</h3><div class="usage"><code>(session &amp; options)</code></div><div class="doc"><p>Creates a session from the given <code>connection</code>.</p><p>If no connection is provided, the default shared connection is used.</p><p>The following options are supported <em>[default]</em>:</p><ul><li><code>:mode</code>       - one of: <code>:auto-ack</code>, <code>:client-ack</code>, <code>:transacted</code> <em>[<code>:auto-ack</code>]</em></li><li><code>:connection</code> - a connection to use; caller expected to close <em>[nil]</em></li></ul><p>If given a <code>:connection</code>, the connection is remembered and used as a default option to any fn that takes a session and a connection.</p><p>You are responsible for closing any sessions created via this function.</p><p>TODO: more docs/examples</p></div><div class="src-link"><a href="https://github.com/immutant/immutant/tree/2.0.0-alpha1/messaging/src/immutant/messaging.clj#L122">view source</a></div></div><div class="public anchor" id="var-stop"><h3>stop</h3><div class="usage"><code>(stop x)</code></div><div class="doc"><p>Stops the given connection, destination, listener, session, or subscription listener.</p><p>Note that stopping a destination may remove it from the broker if called outside of the container.</p></div><div class="src-link"><a href="https://github.com/immutant/immutant/tree/2.0.0-alpha1/messaging/src/immutant/messaging.clj#L361">view source</a></div></div><div class="public anchor" id="var-subscribe"><h3>subscribe</h3><div class="usage"><code>(subscribe topic subscription-name f &amp; options)</code></div><div class="doc"><p>Sets up a durable subscription to <code>topic</code>, and registers a listener with <code>f</code>.</p><p><code>subscription-name</code> is used to identify the subscription, allowing you to stop the listener and resubscribe with the same name in the future without losing messages sent in the interim.</p><p>If a <code>:selector</code> is provided, then only messages having metadata/properties matching that expression may be received.</p><p>If no connection is provided, a new connection is created for this subscriber. If a connection is provided, it must have its <code>:client-id</code> set.</p><p>The following options are supported <em>[default]</em>:</p><ul><li><code>:selector</code>     - A JMS (SQL 92) expression matching message metadata/properties <em>[nil]</em></li><li><code>:decode?</code>      - if true, the decoded message body is passed to <code>f</code>. Otherwise, the                    javax.jms.Message object is passed <em>[true]</em></li><li><code>:connection</code>   - a connection to use; caller expected to close <em>[nil]</em></li></ul><p>Returns a listener object that can can be stopped by passing it to <code><a href="immutant.messaging.html#var-stop">stop</a></code>, or by calling .close on it.</p><p>Subscriptions should be torn down when no longer needed - see <code><a href="immutant.messaging.html#var-unsubscribe">unsubscribe</a></code>.</p></div><div class="src-link"><a href="https://github.com/immutant/immutant/tree/2.0.0-alpha1/messaging/src/immutant/messaging.clj#L301">view source</a></div></div><div class="public anchor" id="var-topic"><h3>topic</h3><div class="usage"><code>(topic topic-name &amp; options)</code></div><div class="doc"><p>Establishes a handle to a messaging topic.</p><p>The following options are supported <em>[default]</em>:</p><ul><li><code>:connection</code> - a connection to a remote broker <em>[nil]</em></li></ul><p>If given a <code>:connection</code>, the connection is remembered and used as a default option to any fn that takes a topic and a connection.</p><p>This creates the topic if no <code>:connection</code> is provided and it does not yet exist.</p></div><div class="src-link"><a href="https://github.com/immutant/immutant/tree/2.0.0-alpha1/messaging/src/immutant/messaging.clj#L60">view source</a></div></div><div class="public anchor" id="var-unsubscribe"><h3>unsubscribe</h3><div class="usage"><code>(unsubscribe topic subscription-name &amp; options)</code></div><div class="doc"><p>Tears down the durable topic subscription on <code>topic</code> named <code>subscription-name</code>.</p><p>If no connection is provided, a new connection is created for this action. If a connection is provided, it must have its <code>:client-id</code> set to the same value used when creating the subscription. See <code><a href="immutant.messaging.html#var-subscribe">subscribe</a></code>.</p><p>The following options are supported <em>[default]</em>:</p><ul><li><code>:connection</code>   - a connection to use; caller expected to close <em>[nil]</em></li></ul></div><div class="src-link"><a href="https://github.com/immutant/immutant/tree/2.0.0-alpha1/messaging/src/immutant/messaging.clj#L339">view source</a></div></div></div></body></html>