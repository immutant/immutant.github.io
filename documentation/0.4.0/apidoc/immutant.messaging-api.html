<html>
  <head>
    <title>immutant.messaging - Immutant Clojure API API documentation</title>
    <link href="static/favicon.png" rel="icon" />
    <link href="static/favicon.png" rel="shortcut icon" />
    <link media="all" type="text/css" href="static/clojure.css" rel="stylesheet" />
    <link media="all" type="text/css" href="static/wiki.css" rel="stylesheet" />
    <link media="all" type="text/css" href="static/internal.css" rel="stylesheet" />
    <style>.menuWrapper{height: 36px;}</style>
    <!--[if lte IE 6]>
    <link rel="stylesheet" href="http://www.wikispaces.com/_/2009051601/s/internal_ie.css" type="text/css" />
    <![endif]-->
  </head>
<!--
This document was auto-generated from the source by the clojure autodoc system.
To report errors or ask questions about the overall documentation structure, formatting,
etc., contact Tom Faulhaber (google mail name: tomfaulhaber).
For errors in the documentation of a particular namespace, contact the author of that
namespace.
-->
  <body>
    <div id="AllContentContainer">
      <div id="Header">
	<!-- <a href="index.html" id="Logo"><img src="static/immutant-icon.gif" width="100" height="100" alt="Immutant" /></a> -->
	<h1><a title="page header title" id="page-header" href="index.html">Immutant Clojure API</a> - v0.4.0</h1>
      </div>
      <div id="leftcolumn"><div style="text-align: center;"></div>
<div class="menu">
  <div class="WikiCustomNav WikiElement wiki">
    <span class="toc-header"><span id="project-name">Immutant Clojure API</span> <span id="version"></span></span><br />
    <ul>
      <li><a class="wiki_link" href="index.html">Overview</a></li>
      <li><a class="wiki_link" href="api-index.html">API Index</a></li>
    </ul>
    <div class="NamespaceTOC">
      <span class="toc-header">Namespaces</span>
      <ul id="left-sidebar-list">
        <li><a href="immutant.web-api.html" class="wiki_link">immutant.web</a></li><li><a href="immutant.daemons-api.html" class="wiki_link">immutant.daemons</a></li><li><a href="immutant.messaging-api.html" class="wiki_link">immutant.messaging</a></li><li><a href="immutant.runtime-api.html" class="wiki_link">immutant.runtime</a></li><li><a href="immutant.repl-api.html" class="wiki_link">immutant.repl</a></li><li><a href="immutant.hooks-api.html" class="wiki_link">immutant.hooks</a></li><li><a href="immutant.dev-api.html" class="wiki_link">immutant.dev</a></li><li><a href="immutant.jobs-api.html" class="wiki_link">immutant.jobs</a></li><li><a href="immutant.cache-api.html" class="wiki_link">immutant.cache</a></li><li><a href="immutant.xa-api.html" class="wiki_link">immutant.xa</a></li>
      </ul>
    </div>
    
    <a href="http://immutant.org" class="wiki_link">Immutant Home</a>
    <a href="../index.html" class="wiki_link">Immutant Manual</a>

  </div>
</div>
</div>
      <div id="rightcolumn">
	<div id="Content">
	  <div class="contentBox"><div class="innerContentBox">
              <div id="content_view" class="wiki wikiPage">
                <div id="right-sidebar"><div id="toc">
  <h1 class="nopad">Table of Contents</h1>
  <div style="margin-left: 1em;" class="toc-section">
    <a href="#immutant.messaging">immutant.messaging</a>
    <div style="margin-left: 1em;" class="toc-entry">
      <a href="#immutant.messaging/listen">listen</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#immutant.messaging/message-seq">message-seq</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#immutant.messaging/publish">publish</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#immutant.messaging/receive">receive</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#immutant.messaging/request">request</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#immutant.messaging/respond">respond</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#immutant.messaging/start">start</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#immutant.messaging/stop">stop</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#immutant.messaging/unlisten">unlisten</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#immutant.messaging/unsubscribe">unsubscribe</a>
    </div>
    <br />
  </div><div style="margin-left: 1em;" class="toc-section">
    <a href="#immutant.messaging.codecs">immutant.messaging.codecs</a>
    <div style="margin-left: 1em;" class="toc-entry">
      <a href="#immutant.messaging.codecs/AsText">AsText</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#immutant.messaging.codecs/decode-if">decode-if</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#immutant.messaging.codecs/get-encoding">get-encoding</a>
    </div>
    <br />
  </div><div style="margin-left: 1em;" class="toc-section">
    <a href="#immutant.messaging.core">immutant.messaging.core</a>
    <div style="margin-left: 1em;" class="toc-entry">
      <a href="#immutant.messaging.core/create-connection">create-connection</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#immutant.messaging.core/create-consumer">create-consumer</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#immutant.messaging.core/enlist-session">enlist-session</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#immutant.messaging.core/get-properties">get-properties</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#immutant.messaging.core/set-attributes!">set-attributes!</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#immutant.messaging.core/set-properties!">set-properties!</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#immutant.messaging.core/wait-for-destination">wait-for-destination</a>
    </div><div style="margin-left: 1em;" class="toc-entry">
      <a href="#immutant.messaging.core/wash-publish-options">wash-publish-options</a>
    </div>
    <br />
  </div><div style="margin-left: 1em;" class="toc-section">
    <a href="#immutant.messaging.hornetq">immutant.messaging.hornetq</a>
    <div style="margin-left: 1em;" class="toc-entry">
      <a href="#immutant.messaging.hornetq/connection-factory">connection-factory</a>
    </div>
    <br />
  </div>
</div>
</div>
                <div id="content-tag">
<p></p>
<h2 class="namespace-header" id="immutant.messaging">immutant.messaging</h2>
<pre id="namespace-docstr">Easily publish and receive messages containing any type of nested
data structure to dynamically-created topics and queues. Message
distribution is automatically load-balanced when clustered.</pre>


<br />

<div class="var-entry" id="var-entry">
  <h2 id="immutant.messaging/listen">listen</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (listen name-or-dest f &amp; {:keys [concurrency decode?], :or {concurrency 1, decode? true}, :as opts})
</pre>
  <pre id="var-docstr">The handler function, f, will receive each message sent to dest.
dest can either be the name of the destination or a
javax.jms.Destination.

The following options are supported [default]:
  :concurrency  the number of threads handling messages [1]
  :selector     A JMS (SQL 92) expression matching message metadata/properties
  :decode?      if true, the decoded message body is passed to f. Otherwise, the
                javax.jms.Message object is passed [true]
  :client-id    identifies a durable topic subscriber, ignored for queues [nil]
  :host         the remote host to connect to (default is to connect in-vm) [nil]
  :port         the remote port to connect to (requires :host to be set) [nil,
                or 5445 if :host is set]
  :username     the username to use to auth the connection (requires :password
                to be set) [nil]
  :password     the password to use to auth the connection (requires :username
                to be set) [nil]</pre>
  
  
  <a href="https://github.com/immutant/immutant/blob/68c37dc530c4e96d8d15e148f77b5a6e4bc246bf/./modules/messaging/src/main/clojure/immutant/messaging.clj#L114" id="var-source">Source</a>
</div><div class="var-entry" id="var-entry">
  <h2 id="immutant.messaging/message-seq">message-seq</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (message-seq dest &amp; opts)
</pre>
  <pre id="var-docstr">A lazy sequence of messages received from a destination. Accepts
same options as receive</pre>
  
  
  <a href="https://github.com/immutant/immutant/blob/68c37dc530c4e96d8d15e148f77b5a6e4bc246bf/./modules/messaging/src/main/clojure/immutant/messaging.clj#L108" id="var-source">Source</a>
</div><div class="var-entry" id="var-entry">
  <h2 id="immutant.messaging/publish">publish</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (publish name-or-dest message &amp; {:as opts})
</pre>
  <pre id="var-docstr">Send a message to a destination. dest can either be the name of the
destination or a javax.jms.Destination. If the message is a
javax.jms.Message, then the message is sent without modification.
If the message contains metadata, it will be transferred as JMS
properties and reconstituted upon receipt. Metadata keys must be
valid Java identifiers (because they can be used in selectors) and
can be overridden using the :properties option. Returns the JMS
message object that was published.

The following options are supported [default]:
  :encoding        :clojure :json or :text [:clojure]
  :priority        0-9 or :low :normal :high :critical [4]
  :ttl             time to live, in ms [0=forever]
  :persistent      whether undelivered messages survive restarts [true]
  :properties      a hash to which selectors may be applied, overrides metadata [nil]
  :correlation-id  used to set the JMSCorrelationID [nil]
                   see <a href="http://docs.oracle.com/javaee/6/api/javax/jms/Message.html#setJMSCorrelationID">http://docs.oracle.com/javaee/6/api/javax/jms/Message.html#setJMSCorrelationID</a>(java.lang.String) 
  :host            the remote host to connect to (default is to connect in-vm)
                   [nil]
  :port            the remote port to connect to (requires :host to be set)
                   [nil, or 5445 if :host is set]
  :username        the username to use to auth the connection (requires :password
                   to be set) [nil]
  :password        the password to use to auth the connection (requires :username
                   to be set) [nil]</pre>
  
  
  <a href="https://github.com/immutant/immutant/blob/68c37dc530c4e96d8d15e148f77b5a6e4bc246bf/./modules/messaging/src/main/clojure/immutant/messaging.clj#L41" id="var-source">Source</a>
</div><div class="var-entry" id="var-entry">
  <h2 id="immutant.messaging/receive">receive</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (receive name-or-dest &amp; {:keys [timeout decode?], :or {timeout 10000, decode? true}, :as opts})
</pre>
  <pre id="var-docstr">Receive a message from a destination. dest can either be the name
of the destination or a javax.jms.Destination.

The following options are supported [default]:
  :timeout    time in ms, after which nil is returned [10000]
  :selector   A JMS (SQL 92) expression matching message metadata/properties
  :decode?    if true, the decoded message body is returned. Otherwise, the
              javax.jms.Message object is returned [true]
  :client-id  identifies a durable topic subscriber, ignored for queues [nil]
  :host       the remote host to connect to (default is to connect in-vm) [nil]
  :port       the remote port to connect to (requires :host to be set) [nil, or
              5445 if :host is set]
  :username   the username to use to auth the connection (requires :password to
              be set) [nil]
  :password   the password to use to auth the connection (requires :username to
              be set) [nil]</pre>
  
  
  <a href="https://github.com/immutant/immutant/blob/68c37dc530c4e96d8d15e148f77b5a6e4bc246bf/./modules/messaging/src/main/clojure/immutant/messaging.clj#L82" id="var-source">Source</a>
</div><div class="var-entry" id="var-entry">
  <h2 id="immutant.messaging/request">request</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (request queue message &amp; {:as opts})
</pre>
  <pre id="var-docstr">Send a message to queue and return a delay that will retrieve the response.
Implements the request-response pattern, and is used in conjunction
with respond. The queue parameter can either be the name of a
queue or an actual javax.jms.Queue.

It takes the same options as publish, and one more [default]:
  :timeout  time in ms for the delayed receive to wait once it it is
            dereferenced, after which nil is returned [10000]</pre>
  
  
  <a href="https://github.com/immutant/immutant/blob/68c37dc530c4e96d8d15e148f77b5a6e4bc246bf/./modules/messaging/src/main/clojure/immutant/messaging.clj#L150" id="var-source">Source</a>
</div><div class="var-entry" id="var-entry">
  <h2 id="immutant.messaging/respond">respond</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (respond queue f &amp; {:keys [decode?], :or {decode? true}, :as opts})
</pre>
  <pre id="var-docstr">Listen for messages on queue sent by the request function and
respond with the result of applying f to the message. queue can
either be the name of the queue or a javax.jms.Queue. Accepts the
same options as listen.</pre>
  
  
  <a href="https://github.com/immutant/immutant/blob/68c37dc530c4e96d8d15e148f77b5a6e4bc246bf/./modules/messaging/src/main/clojure/immutant/messaging.clj#L169" id="var-source">Source</a>
</div><div class="var-entry" id="var-entry">
  <h2 id="immutant.messaging/start">start</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (start name &amp; opts)
</pre>
  <pre id="var-docstr">Create a message destination; name should begin with either 'queue'
or 'topic'

The following options are supported [default]:
  :durable    whether queue items persist across restarts [false]
  :selector   A JMS (SQL 92) expression matching message metadata/properties [""]</pre>
  
  
  <a href="https://github.com/immutant/immutant/blob/68c37dc530c4e96d8d15e148f77b5a6e4bc246bf/./modules/messaging/src/main/clojure/immutant/messaging.clj#L28" id="var-source">Source</a>
</div><div class="var-entry" id="var-entry">
  <h2 id="immutant.messaging/stop">stop</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (stop name)
</pre>
  <pre id="var-docstr">Destroy a message destination. Typically not necessary since it
will be done for you when your app is undeployed. This will fail
with a warning if any handlers are listening or any messages are
yet to be delivered. Returns true on success</pre>
  
  
  <a href="https://github.com/immutant/immutant/blob/68c37dc530c4e96d8d15e148f77b5a6e4bc246bf/./modules/messaging/src/main/clojure/immutant/messaging.clj#L202" id="var-source">Source</a>
</div><div class="var-entry" id="var-entry">
  <h2 id="immutant.messaging/unlisten">unlisten</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (unlisten listener)
</pre>
  <pre id="var-docstr">Pass the result of a call to listen or respond to de-register the handler.
You only need to do this if you wish to stop the handler's
destination before your app is undeployed.</pre>
  
  
  <a href="https://github.com/immutant/immutant/blob/68c37dc530c4e96d8d15e148f77b5a6e4bc246bf/./modules/messaging/src/main/clojure/immutant/messaging.clj#L195" id="var-source">Source</a>
</div><div class="var-entry" id="var-entry">
  <h2 id="immutant.messaging/unsubscribe">unsubscribe</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (unsubscribe client-id &amp; {:keys [subscriber-name], :or {subscriber-name default-subscriber-name}, :as opts})
</pre>
  <pre id="var-docstr">Used when durable topic subscribers are no longer interested. This
cleans up some server-side state, but since it'll be be deleted
anyway when the topic is stopped, it's an optional call</pre>
  
  
  <a href="https://github.com/immutant/immutant/blob/68c37dc530c4e96d8d15e148f77b5a6e4bc246bf/./modules/messaging/src/main/clojure/immutant/messaging.clj#L187" id="var-source">Source</a>
</div>
<h2 class="namespace-header sub-namespace" id="immutant.messaging.codecs">immutant.messaging.codecs</h2>
<pre id="namespace-docstr"></pre>


<br />
<div class="var-entry" id="var-entry">
  <h2 id="immutant.messaging.codecs/AsText">AsText</h2>
  <span id="var-type">var</span><br />
  <pre id="var-usage"></pre>
  <pre id="var-docstr">Function for extracting text from a message.</pre>
  
  
  <a href="https://github.com/immutant/immutant/blob/7ecdc79e336599e07e1150048addae15fd59eb43/./modules/messaging/src/main/clojure/immutant/messaging/codecs.clj#L34" id="var-source">Source</a>
</div><div class="var-entry" id="var-entry">
  <h2 id="immutant.messaging.codecs/decode-if">decode-if</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (decode-if decode? msg)
</pre>
  <pre id="var-docstr">Decodes the given message if decode? is truthy. If the decoded
message is a clojure collection, the properties of the message will
be affixed as metadata</pre>
  
  
  <a href="https://github.com/immutant/immutant/blob/7ecdc79e336599e07e1150048addae15fd59eb43/./modules/messaging/src/main/clojure/immutant/messaging/codecs.clj#L91" id="var-source">Source</a>
</div><div class="var-entry" id="var-entry">
  <h2 id="immutant.messaging.codecs/get-encoding">get-encoding</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (get-encoding msg)
</pre>
  <pre id="var-docstr">Retrieve the encoding from a JMS message.</pre>
  
  
  <a href="https://github.com/immutant/immutant/blob/7ecdc79e336599e07e1150048addae15fd59eb43/./modules/messaging/src/main/clojure/immutant/messaging/codecs.clj#L29" id="var-source">Source</a>
</div>
<h2 class="namespace-header sub-namespace" id="immutant.messaging.core">immutant.messaging.core</h2>
<pre id="namespace-docstr"></pre>


<br />
<div class="var-entry" id="var-entry">
  <h2 id="immutant.messaging.core/create-connection">create-connection</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (create-connection opts)
</pre>
  <pre id="var-docstr">Creates a connection and registers it in the *connections* map</pre>
  
  
  <a href="https://github.com/immutant/immutant/blob/68c37dc530c4e96d8d15e148f77b5a6e4bc246bf/./modules/messaging/src/main/clojure/immutant/messaging/core.clj#L169" id="var-source">Source</a>
</div><div class="var-entry" id="var-entry">
  <h2 id="immutant.messaging.core/create-consumer">create-consumer</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (create-consumer session destination {:keys [selector client-id subscriber-name], :or {subscriber-name default-subscriber-name}})
</pre>
  <pre id="var-docstr">Creates a consumer for a session and destination that may be a durable topic subscriber</pre>
  
  
  <a href="https://github.com/immutant/immutant/blob/68c37dc530c4e96d8d15e148f77b5a6e4bc246bf/./modules/messaging/src/main/clojure/immutant/messaging/core.clj#L177" id="var-source">Source</a>
</div><div class="var-entry" id="var-entry">
  <h2 id="immutant.messaging.core/enlist-session">enlist-session</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (enlist-session session)
</pre>
  <pre id="var-docstr">Enlist a session in the current transaction, if any</pre>
  
  
  <a href="https://github.com/immutant/immutant/blob/68c37dc530c4e96d8d15e148f77b5a6e4bc246bf/./modules/messaging/src/main/clojure/immutant/messaging/core.clj#L184" id="var-source">Source</a>
</div><div class="var-entry" id="var-entry">
  <h2 id="immutant.messaging.core/get-properties">get-properties</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (get-properties message &amp; {:keys [keywords], :or {keywords true}})
</pre>
  <pre id="var-docstr">Extract properties from message into a map, turning the JMS
property names into keywords unless the :keywords option is false</pre>
  
  
  <a href="https://github.com/immutant/immutant/blob/68c37dc530c4e96d8d15e148f77b5a6e4bc246bf/./modules/messaging/src/main/clojure/immutant/messaging/core.clj#L111" id="var-source">Source</a>
</div><div class="var-entry" id="var-entry">
  <h2 id="immutant.messaging.core/set-attributes!">set-attributes!</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (set-attributes! message attributes)
</pre>
  <pre id="var-docstr">Sets attributes on a JMS message. Returns message.</pre>
  
  
  <a href="https://github.com/immutant/immutant/blob/68c37dc530c4e96d8d15e148f77b5a6e4bc246bf/./modules/messaging/src/main/clojure/immutant/messaging/core.clj#L88" id="var-source">Source</a>
</div><div class="var-entry" id="var-entry">
  <h2 id="immutant.messaging.core/set-properties!">set-properties!</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (set-properties! message properties)
</pre>
  <pre id="var-docstr">Set user-defined properties on a JMS message. Returns message</pre>
  
  
  <a href="https://github.com/immutant/immutant/blob/68c37dc530c4e96d8d15e148f77b5a6e4bc246bf/./modules/messaging/src/main/clojure/immutant/messaging/core.clj#L99" id="var-source">Source</a>
</div><div class="var-entry" id="var-entry">
  <h2 id="immutant.messaging.core/wait-for-destination">wait-for-destination</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (wait-for-destination f &amp; [count])
</pre>
  <pre id="var-docstr">Ignore exceptions, retrying until destination completely starts up</pre>
  
  
  <a href="https://github.com/immutant/immutant/blob/68c37dc530c4e96d8d15e148f77b5a6e4bc246bf/./modules/messaging/src/main/clojure/immutant/messaging/core.clj#L246" id="var-source">Source</a>
</div><div class="var-entry" id="var-entry">
  <h2 id="immutant.messaging.core/wash-publish-options">wash-publish-options</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (wash-publish-options opts producer)
</pre>
  <pre id="var-docstr">Wash publish options relative to default values from a producer</pre>
  
  
  <a href="https://github.com/immutant/immutant/blob/68c37dc530c4e96d8d15e148f77b5a6e4bc246bf/./modules/messaging/src/main/clojure/immutant/messaging/core.clj#L74" id="var-source">Source</a>
</div>
<h2 class="namespace-header sub-namespace" id="immutant.messaging.hornetq">immutant.messaging.hornetq</h2>
<pre id="namespace-docstr"></pre>


<br />
<div class="var-entry" id="var-entry">
  <h2 id="immutant.messaging.hornetq/connection-factory">connection-factory</h2>
  <span id="var-type">function</span><br />
  <pre id="var-usage">Usage: (connection-factory)
       (connection-factory {:keys [host port], :or {host localhost, port 5445}})
</pre>
  <pre id="var-docstr">Create a connection factory, typically invoked when outside container</pre>
  
  
  <a href="https://github.com/immutant/immutant/blob/040d3834894dbfb3e0c239b24dd0b3a8b50546f0/./modules/messaging/src/main/clojure/immutant/messaging/hornetq.clj#L22" id="var-source">Source</a>
</div>


</div>
              </div>
            </div>
          </div>
	</div>
	<div id="foot">
	  <div style="text-align: center;" id="copyright">Copyright 2011-2012 Red Hat, Inc.</div>
	</div>
      </div>
      <div id="DesignedBy">Based on a site design by <a title="Visit Tom Hickey's website." href="http://www.tomhickey.com">Tom Hickey</a>.<br />
      <a href="http://tomfaulhaber.github.com/autodoc/">Clojure auto-documentation system</a> by Tom Faulhaber.</div>
    </div>
    <!-- /AllContentContainer -->
  </body>

</html>