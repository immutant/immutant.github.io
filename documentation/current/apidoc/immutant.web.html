<!DOCTYPE html>
<html><head><meta charset="UTF-8"><link href="css/default.css" rel="stylesheet" type="text/css"><script src="js/jquery.min.js" type="text/javascript"></script><script src="js/page_effects.js" type="text/javascript"></script><title>immutant.web documentation</title><link href="assets/immutant.css" rel="stylesheet" type="text/css"></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a></h2><h1><a href="index.html">Immutant 2.1.10 API documentation</a></h1></div><div class="sidebar" id="namespaces"><div id="guides"><h3><a href="index.html"><span class="inner">Guides</span></a></h3><ul><li class="guide Migration-current"><a href="guide-migration.html"><div class="inner"><span>Migration</span></div></a></li><li class="guide Installation-current"><a href="guide-installation.html"><div class="inner"><span>Installation</span></div></a></li><li class="guide Web-current"><a href="guide-web.html"><div class="inner"><span>Web</span></div></a></li><li class="guide Messaging-current"><a href="guide-messaging.html"><div class="inner"><span>Messaging</span></div></a></li><li class="guide Scheduling-current"><a href="guide-scheduling.html"><div class="inner"><span>Scheduling</span></div></a></li><li class="guide Caching-current"><a href="guide-caching.html"><div class="inner"><span>Caching</span></div></a></li><li class="guide Transactions-current"><a href="guide-transactions.html"><div class="inner"><span>Transactions</span></div></a></li><li class="guide WildFly-current"><a href="guide-wildfly.html"><div class="inner"><span>WildFly</span></div></a></li><li class="guide EAP 6.4.x-current"><a href="guide-EAP.html"><div class="inner"><span>EAP 6.4.x</span></div></a></li><li class="guide Logging-current"><a href="guide-logging.html"><div class="inner"><span>Logging</span></div></a></li></ul></div><h3><a href="index.html"><span class="inner">Namespaces</span></a></h3><ul><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>immutant</span></div></div></li><li class="depth-2"><a href="immutant.caching.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>caching</span></div></a></li><li class="depth-3 branch"><a href="immutant.caching.core-cache.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>core-cache</span></div></a></li><li class="depth-3"><a href="immutant.caching.core-memoize.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>core-memoize</span></div></a></li><li class="depth-2"><a href="immutant.codecs.html"><div class="inner"><span class="tree" style="top: -83px;"><span class="top" style="height: 92px;"></span><span class="bottom"></span></span><span>codecs</span></div></a></li><li class="depth-3"><a href="immutant.codecs.fressian.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>fressian</span></div></a></li><li class="depth-2 branch"><a href="immutant.coercions.html"><div class="inner"><span class="tree" style="top: -52px;"><span class="top" style="height: 61px;"></span><span class="bottom"></span></span><span>coercions</span></div></a></li><li class="depth-2 branch"><a href="immutant.daemons.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>daemons</span></div></a></li><li class="depth-2"><a href="immutant.messaging.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>messaging</span></div></a></li><li class="depth-3 branch"><a href="immutant.messaging.hornetq.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>hornetq</span></div></a></li><li class="depth-3"><a href="immutant.messaging.pipeline.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>pipeline</span></div></a></li><li class="depth-2"><a href="immutant.scheduling.html"><div class="inner"><span class="tree" style="top: -83px;"><span class="top" style="height: 92px;"></span><span class="bottom"></span></span><span>scheduling</span></div></a></li><li class="depth-3 branch"><a href="immutant.scheduling.joda.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>joda</span></div></a></li><li class="depth-3"><a href="immutant.scheduling.quartz.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>quartz</span></div></a></li><li class="depth-2"><a href="immutant.transactions.html"><div class="inner"><span class="tree" style="top: -83px;"><span class="top" style="height: 92px;"></span><span class="bottom"></span></span><span>transactions</span></div></a></li><li class="depth-3 branch"><a href="immutant.transactions.jdbc.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>jdbc</span></div></a></li><li class="depth-3"><a href="immutant.transactions.scope.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>scope</span></div></a></li><li class="depth-2 branch"><a href="immutant.util.html"><div class="inner"><span class="tree" style="top: -83px;"><span class="top" style="height: 92px;"></span><span class="bottom"></span></span><span>util</span></div></a></li><li class="depth-2 current"><a href="immutant.web.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>web</span></div></a></li><li class="depth-3 branch"><a href="immutant.web.async.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>async</span></div></a></li><li class="depth-3 branch"><a href="immutant.web.middleware.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>middleware</span></div></a></li><li class="depth-3 branch"><a href="immutant.web.sse.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>sse</span></div></a></li><li class="depth-3 branch"><a href="immutant.web.ssl.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>ssl</span></div></a></li><li class="depth-3"><a href="immutant.web.undertow.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>undertow</span></div></a></li><li class="depth-2"><a href="immutant.wildfly.html"><div class="inner"><span class="tree" style="top: -176px;"><span class="top" style="height: 185px;"></span><span class="bottom"></span></span><span>wildfly</span></div></a></li></ul></div><div class="sidebar" id="vars"><h3><a href="#top"><span class="inner">Public Vars</span></a></h3><ul><li class="depth-1"><a href="immutant.web.html#var-run"><div class="inner"><span>run</span></div></a></li><li class="depth-1"><a href="immutant.web.html#var-run-dmc"><div class="inner"><span>run-dmc</span></div></a></li><li class="depth-1"><a href="immutant.web.html#var-server"><div class="inner"><span>server</span></div></a></li><li class="depth-1"><a href="immutant.web.html#var-stop"><div class="inner"><span>stop</span></div></a></li></ul></div><div class="namespace-docs" id="content"><h2 class="anchor" id="top">immutant.web</h2><div class="doc"><div class="markdown"><p>Serve web requests using Ring handlers, Servlets, or Undertow HttpHandlers</p></div></div><div class="public anchor" id="var-run"><h3>run</h3><div class="usage"><code>(run handler &amp; options)</code></div><div class="doc"><div class="markdown"><p>Runs <code>handler</code> with the given <code>options</code>.</p><p><code>handler</code> can be a Ring handler function, a Servlet, or an  Undertow HttpHandler. Can be called multiple times - if given the  same options, any prior handler with those options will be replaced. Returns  the given options with any missing defaults filled in.</p><p>options can be a map or kwargs, with these valid keys [default]:</p>
<ul>
  <li><code>:host</code> The interface bind address [&ldquo;localhost&rdquo;]</li>
  <li><code>:port</code> The port listening for requests [8080]</li>
  <li><code>:path</code> Maps the handler to a prefix of the url path [&ldquo;/&rdquo;]</li>
  <li><code>:virtual-host</code> Virtual host name[s] (a String or a List of Strings) [nil]</li>
  <li><code>:dispatch?</code> Invoke handlers in worker thread pool [true]</li>
</ul><p>When <code>handler</code> is a Servlet, the following options are also supported:</p>
<ul>
  <li><code>:servlet-name</code> The servlet&rsquo;s registered name [the <code>:path</code>]</li>
  <li><code>:filter-map</code> An insertion-order-preserving mapping, e.g. array-map  or LinkedHashMap, of names to Filter instances [nil]</li>
</ul><p>Note the web server only binds to the loopback interface, by  default. To expose your handler to the network, set <code>:host</code> to an  external IP address, or use &ldquo;0.0.0.0&rdquo; to bind it to all interfaces.</p><p>The <code>:virtual-host</code> option enables name-based virtual hosting which,  along with the <code>:path</code> option, distinguishes the handlers on a single  server. That is, multiple handlers can run on the same <code><code>:host</code></code> and  <code><code>:port</code></code> as long as each has a unique combination of <code><code>:virtual-host</code></code>  and <code><code>:path</code></code>.</p><p>Run calls may be threaded together:</p><p><code>
   (-&gt; (run ello)
     (assoc <code>:path</code> &quot;/owdy&quot;)
     (-&gt;&gt; (run owdy))
     (merge {<code>:path</code> &quot;/&quot; <code>:port</code> 8081})
     (-&gt;&gt; (run ola)))
</code></p><p>The above actually creates two web server instances, one listening  for ello and owdy requests on port 8080, and another listening  for ola requests on 8081.</p><p>For ring handlers, the actual writing of the response happens after  your hander returns. If an exception occurs on the write (the most  common case being an IOException because the client has gone away),  the default behavior is to log the exception. If you would like to  be able to handle that exception yourself, you can return a function  in the ring response under <code>:write-error-handler</code>. This function will  be called with the exception, the request map, and the response map  if an exception occurs when writing the response. Note that this  handler can&rsquo;t actually affect the response. If you would prefer  a global handler, see <code><a href="immutant.web.middleware.html#var-wrap-write-error-handling">immutant.web.middleware/wrap-write-error-handling</a></code>.</p><p>The underlying web server for Immutant is Undertow, which supports  more advanced options than the above. These can be configured by  passing an <code>Undertow$Builder</code> via the <code>:configuration</code> option, an  instance of which is easily constructed from a map of valid  keywords using the <code><a href="immutant.web.undertow.html#var-options">immutant.web.undertow/options</a></code> function. For  convenience, all of its option keywords are valid for <code>run</code>, too:  if present, an <code>Undertow$Builder</code> will be returned in the result.</p><p>If your handlers are compute-bound, you may be able to gain some  performance by setting <code>:dispatch?</code> to false. This causes the  handlers to run on Undertow&rsquo;s I/O threads, avoiding the context  switch of dispatching them to the worker thread pool, at the  risk of refusing client requests under load. Note that when  <code>:dispatch?</code> is false, returning a seq, File, or InputStream as a  ring body will cause that request to be dispatched to a worker  thread at write time to prevent blocking an I/O thread.</p><p>Inside WildFly, the <code>:host</code>, <code>:port</code>, <code>:configuration</code>, and <code>:dispatch?</code>  options are ignored, since all handlers are mounted as servlets  contained within WildFly&rsquo;s own Undertow instance. Further, all  invocations of <code>run</code> must be within the initialization function for  your application, i.e. your <code>-main</code>.</p></div></div><div class="src-link"><a href="https://github.com/immutant/immutant/tree/2.1.10/web/src/immutant/web.clj#L23">view source</a></div></div><div class="public anchor" id="var-run-dmc"><h3>run-dmc</h3><h4 class="type">macro</h4><div class="usage"><code>(run-dmc handler &amp; options)</code></div><div class="doc"><div class="markdown"><p>Run in Development Mode (the &lsquo;C&rsquo; is silent).</p><p>This macro invokes <code><a href="immutant.web.html#var-run">run</a></code> after ensuring the passed handler is var-quoted, with reload and stacktrace middleware applied, and then opens the app in a browser. Supports the same options as <code><a href="immutant.web.html#var-run">run</a></code>.</p></div></div><div class="src-link"><a href="https://github.com/immutant/immutant/tree/2.1.10/web/src/immutant/web.clj#L143">view source</a></div></div><div class="public anchor" id="var-server"><h3>server</h3><div class="usage"><code>(server &amp; options)</code></div><div class="doc"><div class="markdown"><p>Returns the web server instance associated with a particular set of options, typically the map returned from a <code><a href="immutant.web.html#var-run">run</a></code> call. The web server provides <code>start</code>, <code>stop</code> and <code>isRunning</code> methods, allowing you to, for example, temporarily stop serving requests for all the handlers running on a particular server.</p>
<pre><code>  (let [srv (server (run hello <code>:auto-start</code> false))]
    (.isRunning srv)   ;=&gt; false
    (.start srv)
    (.isRunning srv)   ;=&gt; true
    (.stop srv))
</code></pre><p>The return value is either a single server instance or a list of servers if passed the result from threaded run calls that would cause multiple servers to be created.</p></div></div><div class="src-link"><a href="https://github.com/immutant/immutant/tree/2.1.10/web/src/immutant/web.clj#L157">view source</a></div></div><div class="public anchor" id="var-stop"><h3>stop</h3><div class="usage"><code>(stop &amp; options)</code></div><div class="doc"><div class="markdown"><p>Stops a running handler.</p><p><code>options</code> can be passed as a map or kwargs, but is typically the map returned from a <code><a href="immutant.web.html#var-run">run</a></code> call. If that return value is not available, you can pass the same options map passed to <code><a href="immutant.web.html#var-run">run</a></code> for the handler you want to stop. If options isn&rsquo;t provided, the handler at the root context path (&ldquo;/&rdquo;) of the default server will be stopped. If there are no handlers remaining on the server, the server itself is stopped. Returns true if a handler was actually removed.</p></div></div><div class="src-link"><a href="https://github.com/immutant/immutant/tree/2.1.10/web/src/immutant/web.clj#L121">view source</a></div></div></div></body></html>