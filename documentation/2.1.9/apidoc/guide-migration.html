<!DOCTYPE html>
<html><head><meta charset="UTF-8"><link href="css/default.css" rel="stylesheet" type="text/css"><script src="js/jquery.min.js" type="text/javascript"></script><script src="js/page_effects.js" type="text/javascript"></script><title>Immutant 2.1.9 API documentation</title><link href="assets/immutant.css" rel="stylesheet" type="text/css"></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a></h2><h1><a href="index.html">Immutant 2.1.9 API documentation</a></h1></div><div class="sidebar" id="namespaces"><div id="guides"><h3><a href="index.html"><span class="inner">Guides</span></a></h3><ul><li class="guide current"><a href="guide-migration.html"><div class="inner"><span>Migration</span></div></a></li><li class="guide Installation-current"><a href="guide-installation.html"><div class="inner"><span>Installation</span></div></a></li><li class="guide Web-current"><a href="guide-web.html"><div class="inner"><span>Web</span></div></a></li><li class="guide Messaging-current"><a href="guide-messaging.html"><div class="inner"><span>Messaging</span></div></a></li><li class="guide Scheduling-current"><a href="guide-scheduling.html"><div class="inner"><span>Scheduling</span></div></a></li><li class="guide Caching-current"><a href="guide-caching.html"><div class="inner"><span>Caching</span></div></a></li><li class="guide Transactions-current"><a href="guide-transactions.html"><div class="inner"><span>Transactions</span></div></a></li><li class="guide WildFly-current"><a href="guide-wildfly.html"><div class="inner"><span>WildFly</span></div></a></li><li class="guide EAP 6.4.x-current"><a href="guide-EAP.html"><div class="inner"><span>EAP 6.4.x</span></div></a></li><li class="guide Logging-current"><a href="guide-logging.html"><div class="inner"><span>Logging</span></div></a></li></ul></div><h3><a href="index.html"><span class="inner">Namespaces</span></a></h3><ul><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>immutant</span></div></div></li><li class="depth-2"><a href="immutant.caching.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>caching</span></div></a></li><li class="depth-3 branch"><a href="immutant.caching.core-cache.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>core-cache</span></div></a></li><li class="depth-3"><a href="immutant.caching.core-memoize.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>core-memoize</span></div></a></li><li class="depth-2"><a href="immutant.codecs.html"><div class="inner"><span class="tree" style="top: -83px;"><span class="top" style="height: 92px;"></span><span class="bottom"></span></span><span>codecs</span></div></a></li><li class="depth-3"><a href="immutant.codecs.fressian.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>fressian</span></div></a></li><li class="depth-2 branch"><a href="immutant.coercions.html"><div class="inner"><span class="tree" style="top: -52px;"><span class="top" style="height: 61px;"></span><span class="bottom"></span></span><span>coercions</span></div></a></li><li class="depth-2 branch"><a href="immutant.daemons.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>daemons</span></div></a></li><li class="depth-2"><a href="immutant.messaging.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>messaging</span></div></a></li><li class="depth-3 branch"><a href="immutant.messaging.hornetq.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>hornetq</span></div></a></li><li class="depth-3"><a href="immutant.messaging.pipeline.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>pipeline</span></div></a></li><li class="depth-2"><a href="immutant.scheduling.html"><div class="inner"><span class="tree" style="top: -83px;"><span class="top" style="height: 92px;"></span><span class="bottom"></span></span><span>scheduling</span></div></a></li><li class="depth-3 branch"><a href="immutant.scheduling.joda.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>joda</span></div></a></li><li class="depth-3"><a href="immutant.scheduling.quartz.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>quartz</span></div></a></li><li class="depth-2"><a href="immutant.transactions.html"><div class="inner"><span class="tree" style="top: -83px;"><span class="top" style="height: 92px;"></span><span class="bottom"></span></span><span>transactions</span></div></a></li><li class="depth-3 branch"><a href="immutant.transactions.jdbc.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>jdbc</span></div></a></li><li class="depth-3"><a href="immutant.transactions.scope.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>scope</span></div></a></li><li class="depth-2 branch"><a href="immutant.util.html"><div class="inner"><span class="tree" style="top: -83px;"><span class="top" style="height: 92px;"></span><span class="bottom"></span></span><span>util</span></div></a></li><li class="depth-2"><a href="immutant.web.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>web</span></div></a></li><li class="depth-3 branch"><a href="immutant.web.async.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>async</span></div></a></li><li class="depth-3 branch"><a href="immutant.web.middleware.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>middleware</span></div></a></li><li class="depth-3 branch"><a href="immutant.web.sse.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>sse</span></div></a></li><li class="depth-3 branch"><a href="immutant.web.ssl.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>ssl</span></div></a></li><li class="depth-3"><a href="immutant.web.undertow.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>undertow</span></div></a></li><li class="depth-2"><a href="immutant.wildfly.html"><div class="inner"><span class="tree" style="top: -176px;"><span class="top" style="height: 185px;"></span><span class="bottom"></span></span><span>wildfly</span></div></a></li></ul></div><div class='namespace-index guide' id='content'><div class='markdown doc'><div class="guide-content"><h1>Migration Guide</h1><div class="description"><span>Immutant 1.1 -> 2.0 migration guide</span></div><p>This guide aims to ease the transition from Immutant 1.x to 2.x.</p><h2>General Changes</h2><p>The biggest changes in 2.x are the ability to use Immutant libraries embedded in a standard Clojure application, and the ability to deploy an application to an unmodified <a href="http://wildfly.org">WildFly</a> container if you need container/cluster functionality.</p><p>For details, see the <a href="guide-installation.html">Installation Guide</a>, and pay close attention to the way Immutant applications are now initialized (via a standard <code>-main</code> function instead of the Immutant-specific initialization process from 1.x). Also note that the <a href="https://github.com/immutant/lein-immutant">lein-immutant</a> plugin is now only needed if you need to <a href="guide-wildfly.html">create a WAR file to deploy to WildFly</a>.</p><h2>API Changes</h2><p><strong>Structure:</strong> each section covers a namespace. If the namespace has been renamed, that will be reflected by <em>old namespace -&gt; new namespace</em>. If a namespace has been removed, it&rsquo;s marked with a <del>strikethrough</del>.</p><p>This list includes all of the Immutant 1.1 namespaces, some of which were/are for internal use only.</p><h3>immutant.cache -&gt; <a href="immutant.caching.html">immutant.caching</a></h3><p>The <code>Mutable</code> interface is gone. To put something in an Immutant cache, you can use either the new <code>immutant.caching/swap-in!</code> or java interop (<code>org.infinispan.Cache</code> extends <code>ConcurrentMap</code> and therefore <code>Map</code>). To insert entries with various ttl/idle values, use the new <code>with-expiration</code> function.</p><p>Both <code>lookup</code> and <code>create</code> have been collapsed into <code>cache</code>, which behaves like the old <code>lookup-or-create</code>. To force the creation of an existing cache, you must <code>stop</code> the running one. Otherwise, <code>cache</code> will just return it.</p><p>Caches are no longer transactional by default, and if set to be so, require a locking mode to be selected (optimistic by default).</p><p><code>core.cache</code> and <code>core.memoize</code> are no longer transitive dependencies of <code>immutant.caching</code>. To extend an immutant cache to core&rsquo;s <code>CacheProtocol</code>, add <code>org.clojure/core.cache</code> to your project&rsquo;s deps and require <code>immutant.caching.core-cache</code>.</p><p>The <code>memo</code> function has been moved to <code>immutant.caching.core-memoize</code> which you should only require after adding <code>org.clojure/core.memoize</code> to your project&rsquo;s deps.</p><p>Some option keys and values have changed:</p>
<ul>
  <li><code>:sync</code> has been collapsed into <code>:mode</code> to match <code>org.infinispan.configuration.cache/CacheMode</code>, so the possible values of <code>:mode</code> are now:
  <ul>
    <li><code>:local</code></li>
    <li><code>:repl-sync</code></li>
    <li><code>:repl-async</code></li>
    <li><code>:invalidation-sync</code></li>
    <li><code>:invalidation-async</code></li>
    <li><code>:dist-sync</code></li>
    <li><code>:dist-async</code></li>
  </ul></li>
  <li><code>:tx</code> -&gt; <code>:transactional</code></li>
  <li><code>:encoding</code> is gone, replaced with the <code>with-codec</code> fn</li>
  <li><code>:seed</code> is gone</li>
  <li><code>:config</code> is now <code>:configuration</code></li>
</ul><h4><del>immutant.cache.config</del></h4><h4><del>immutant.cache.core</del></h4><h4><del>immutant.cache.wrapper</del></h4><h3><a href="immutant.codecs.html">immutant.codecs</a></h3><p>The <code>:text</code> codec was removed. The default supplied codecs in 2.x are: <code>:none</code>, <code>:edn</code>, and <code>:json</code>. <code>:fressian</code> can be enabled by calling <code>immutant.codecs.fressian/register-fressian-codec</code>.</p><h3><a href="immutant.daemons.html">immutant.daemons</a></h3><p>Now resides in <a href="https://clojars.org/org.immutant/core">org.immutant/core</a>, with a slightly simpler interface.</p><h3><del>immutant.dev</del></h3><p>Used for dev inside the container, but you can get all these same facilities with standard tools outside of the container with 2.x, and we&rsquo;re no longer exposing the project map, so this wouldn&rsquo;t be very useful inside the container with 2.x.</p><h3>immutant.jobs -&gt; <a href="immutant.scheduling.html">immutant.scheduling</a></h3><p>The API is similar. <code>schedule</code> now takes a map or kwargs, and there are now helpers for each option that help you generate that map. A cronspec is no longer a top-level arg, but instead is specified in the map using the <code>:cron</code> key. A name is no longer required, but an optional id can be provided to allow you to reschedule the job.</p><p>The <code>set-scheduler-options</code> is now handled by passing additional options to <code>schedule</code>. If different scheduler options are given on different schedule calls, new schedulers are created.</p><p>If you need access to the raw quartz scheduler, use <a href="immutant.scheduling.quartz.html#var-quartz-scheduler">immutant.scheduling.quartz/quartz-scheduler</a>.</p><h4>immutant.jobs.internal -&gt; immutant.scheduling.internal</h4><h3><del>immutant.logging</del></h3><h3><a href="immutant.messaging.html">immutant.messaging</a></h3><p>Has a similar API, except around destination creation and passing. Fns now take destination objects instead of strings, and the destination objects must be created via <code>queue</code> and <code>topic</code>. Connections and sessions have been replaced with contexts, available from <code>context</code>.</p><p><code>unlisten</code> and <code>stop</code> have been merged in to <code>stop</code>. <code>message-seq</code> is no more.</p><h4><del>immutant.messaging.codecs</del></h4><h4><del>immutant.messaging.core</del></h4><p>Merged with <code>immutant.messaging.internal</code>.</p><h4><a href="immutant.messaging.hornetq.html">immutant.messaging.hornetq</a></h4><p>Brought over with a few changes.</p><h4>immutant.messaging.internal</h4><p>Brought over, but with a drastically different API.</p><h3>immutant.pipeline -&gt; <a href="immutant.messaging.pipeline.html">immutant.messaging.pipeline</a></h3><p>The API is unchanged, other than renaming the namespace.</p><h3><del>immutant.registry</del></h3><p>The registry was used to store application config and the parsed lein project map. We no longer provide those inside Immutant, so the registry is no longer needed for that. You could also use the registry to look up items in the application server&rsquo;s internal registry. That functionality is still available via <a href="immutant.wildfly.html#var-get-from-service-registry">immutant.wildfly/get-from-service-registry</a>.</p><h3>immutant.repl -&gt; immutant.wildfly.repl</h3><p>Still there, but with a different API. It&rsquo;s now only used inside the container.</p><h3><del>immutant.resource-util</del></h3><h3><del>immutant.runtime</del></h3><h4><del>immutant.runtime.bootstrap</del></h4><h3><del>immutant.runtime-util</del></h3><h3>immutant.util</h3><p>Split across three namespaces:</p>
<ul>
  <li><a href="immutant.util.html">immutant.util</a> - fns appropriate for app use</li>
  <li>immutant.internal.util - fns used by Immutant itself, and not intended for app use</li>
  <li><a href="immutant.wildfly.html">immutant.wildfly</a> - in-container specific functions</li>
</ul><h3><a href="immutant.web.html">immutant.web</a></h3>
<ul>
  <li><code>start</code> is now <code>run</code></li>
  <li><code>start-servlet</code> is also now <code>run</code></li>
  <li><code>current-servlet-request</code> currently has no analogue</li>
</ul><h4><del>immutant.web.session</del></h4><p>Obviated by <a href="immutant.web.middleware.html#var-wrap-session">immutant.web.middleware/wrap-session</a>.</p><h4><del>immutant.web.servlet</del></h4><h4><del>immutant.web.session.internal</del></h4><h4><a href="immutant.web.middleware.html">immutant.web.middleware</a></h4><p>Contains only <code>wrap-development</code>, <code>wrap-session</code>, and <code>wrap-websocket</code>.</p><h3>immutant.xa -&gt; <a href="immutant.transactions.html">immutant.transactions</a></h3><p>Listeners are no longer automatically enlisted participants in an XA transaction. Within the handler fn, you must now explicitly define a transaction using one of the macros in <a href="immutant.transactions.html">immutant.transactions</a>. If an exception escapes that body, the tx will be rolled back, and if the exception bubbles out of the handler, the message will be queued for redelivery. But the rollback of the tx has no relationship to redelivery, which is only triggered by the exception.</p><p>Messaging connections, now called contexts, are no longer XA by default, so you must set the :xa? option to true when you create your own contexts to pass to the messaging functions. If you don&rsquo;t pass your own contexts, those functions will create an XA capable context only if within an active transaction as defined by the scoping macros.</p><p>The <code>immutant.xa/datasource</code> function has been removed, as it would be impractical to support it outside of the app server. It&rsquo;s still possible to include SQL datasources within an XA transaction inside WildFly by configuring them there and referring to them by JNDI name. It is also possible to manipulate a non-XA SQL datasource within an XA transaction as long as 1) it&rsquo;s the only non-XA resource and 2) it is operated on last. This &ldquo;trick&rdquo; relies on an exception being thrown if the datasource operation fails, hence causing the other XA participants, e.g. messaging destinations or caches, to roll back.</p><h3>immutant.xa.transaction -&gt; immutant.transactions.scope</h3><p>All the scope macros, analogous to the JEE Transaction attribute annotations, have been moved to <a href="immutant.transactions.scope.html">immutant.transactions.scope</a>. The <a href="immutant.transactions.html#var-transaction">immutant.transactions/transaction</a> macro is an alias for <a href="immutant.transactions.scope.html#var-required">immutant.transactions.scope/required</a>, just as in Immutant 1.x.</p></div></div></div><script src="assets/jquery.syntax.min.js" type="text/javascript"></script><script src="assets/immutant.js" type="text/javascript"></script></body></html>