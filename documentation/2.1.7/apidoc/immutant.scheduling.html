<!DOCTYPE html>
<html><head><meta charset="UTF-8"><link href="css/default.css" rel="stylesheet" type="text/css"><script src="js/jquery.min.js" type="text/javascript"></script><script src="js/page_effects.js" type="text/javascript"></script><title>immutant.scheduling documentation</title><link href="assets/immutant.css" rel="stylesheet" type="text/css"></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a></h2><h1><a href="index.html">Immutant 2.1.7 API documentation</a></h1></div><div class="sidebar" id="namespaces"><div id="guides"><h3><a href="index.html"><span class="inner">Guides</span></a></h3><ul><li class="guide Migration-current"><a href="guide-migration.html"><div class="inner"><span>Migration</span></div></a></li><li class="guide Installation-current"><a href="guide-installation.html"><div class="inner"><span>Installation</span></div></a></li><li class="guide Web-current"><a href="guide-web.html"><div class="inner"><span>Web</span></div></a></li><li class="guide Messaging-current"><a href="guide-messaging.html"><div class="inner"><span>Messaging</span></div></a></li><li class="guide Scheduling-current"><a href="guide-scheduling.html"><div class="inner"><span>Scheduling</span></div></a></li><li class="guide Caching-current"><a href="guide-caching.html"><div class="inner"><span>Caching</span></div></a></li><li class="guide Transactions-current"><a href="guide-transactions.html"><div class="inner"><span>Transactions</span></div></a></li><li class="guide WildFly-current"><a href="guide-wildfly.html"><div class="inner"><span>WildFly</span></div></a></li><li class="guide EAP 6.4.x-current"><a href="guide-EAP.html"><div class="inner"><span>EAP 6.4.x</span></div></a></li><li class="guide Logging-current"><a href="guide-logging.html"><div class="inner"><span>Logging</span></div></a></li></ul></div><h3><a href="index.html"><span class="inner">Namespaces</span></a></h3><ul><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>immutant</span></div></div></li><li class="depth-2"><a href="immutant.caching.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>caching</span></div></a></li><li class="depth-3 branch"><a href="immutant.caching.core-cache.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>core-cache</span></div></a></li><li class="depth-3"><a href="immutant.caching.core-memoize.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>core-memoize</span></div></a></li><li class="depth-2"><a href="immutant.codecs.html"><div class="inner"><span class="tree" style="top: -83px;"><span class="top" style="height: 92px;"></span><span class="bottom"></span></span><span>codecs</span></div></a></li><li class="depth-3"><a href="immutant.codecs.fressian.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>fressian</span></div></a></li><li class="depth-2 branch"><a href="immutant.coercions.html"><div class="inner"><span class="tree" style="top: -52px;"><span class="top" style="height: 61px;"></span><span class="bottom"></span></span><span>coercions</span></div></a></li><li class="depth-2 branch"><a href="immutant.daemons.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>daemons</span></div></a></li><li class="depth-2"><a href="immutant.messaging.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>messaging</span></div></a></li><li class="depth-3 branch"><a href="immutant.messaging.hornetq.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>hornetq</span></div></a></li><li class="depth-3"><a href="immutant.messaging.pipeline.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>pipeline</span></div></a></li><li class="depth-2 current"><a href="immutant.scheduling.html"><div class="inner"><span class="tree" style="top: -83px;"><span class="top" style="height: 92px;"></span><span class="bottom"></span></span><span>scheduling</span></div></a></li><li class="depth-3 branch"><a href="immutant.scheduling.joda.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>joda</span></div></a></li><li class="depth-3"><a href="immutant.scheduling.quartz.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>quartz</span></div></a></li><li class="depth-2"><a href="immutant.transactions.html"><div class="inner"><span class="tree" style="top: -83px;"><span class="top" style="height: 92px;"></span><span class="bottom"></span></span><span>transactions</span></div></a></li><li class="depth-3 branch"><a href="immutant.transactions.jdbc.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>jdbc</span></div></a></li><li class="depth-3"><a href="immutant.transactions.scope.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>scope</span></div></a></li><li class="depth-2 branch"><a href="immutant.util.html"><div class="inner"><span class="tree" style="top: -83px;"><span class="top" style="height: 92px;"></span><span class="bottom"></span></span><span>util</span></div></a></li><li class="depth-2"><a href="immutant.web.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>web</span></div></a></li><li class="depth-3 branch"><a href="immutant.web.async.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>async</span></div></a></li><li class="depth-3 branch"><a href="immutant.web.middleware.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>middleware</span></div></a></li><li class="depth-3 branch"><a href="immutant.web.sse.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>sse</span></div></a></li><li class="depth-3 branch"><a href="immutant.web.ssl.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>ssl</span></div></a></li><li class="depth-3"><a href="immutant.web.undertow.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>undertow</span></div></a></li><li class="depth-2"><a href="immutant.wildfly.html"><div class="inner"><span class="tree" style="top: -176px;"><span class="top" style="height: 185px;"></span><span class="bottom"></span></span><span>wildfly</span></div></a></li></ul></div><div class="sidebar" id="vars"><h3><a href="#top"><span class="inner">Public Vars</span></a></h3><ul><li class="depth-1"><a href="immutant.scheduling.html#var-allow-concurrent-exec.3F"><div class="inner"><span>allow-concurrent-exec?</span></div></a></li><li class="depth-1"><a href="immutant.scheduling.html#var-at"><div class="inner"><span>at</span></div></a></li><li class="depth-1"><a href="immutant.scheduling.html#var-cron"><div class="inner"><span>cron</span></div></a></li><li class="depth-1"><a href="immutant.scheduling.html#var-every"><div class="inner"><span>every</span></div></a></li><li class="depth-1"><a href="immutant.scheduling.html#var-id"><div class="inner"><span>id</span></div></a></li><li class="depth-1"><a href="immutant.scheduling.html#var-in"><div class="inner"><span>in</span></div></a></li><li class="depth-1"><a href="immutant.scheduling.html#var-limit"><div class="inner"><span>limit</span></div></a></li><li class="depth-1"><a href="immutant.scheduling.html#var-schedule"><div class="inner"><span>schedule</span></div></a></li><li class="depth-1"><a href="immutant.scheduling.html#var-singleton"><div class="inner"><span>singleton</span></div></a></li><li class="depth-1"><a href="immutant.scheduling.html#var-stop"><div class="inner"><span>stop</span></div></a></li><li class="depth-1"><a href="immutant.scheduling.html#var-until"><div class="inner"><span>until</span></div></a></li></ul></div><div class="namespace-docs" id="content"><h2 class="anchor" id="top">immutant.scheduling</h2><div class="doc"><div class="markdown"><p>Schedule jobs for execution</p></div></div><div class="public anchor" id="var-allow-concurrent-exec.3F"><h3>allow-concurrent-exec?</h3><div class="usage"><code>(allow-concurrent-exec? boolean)</code><code>(allow-concurrent-exec? m boolean)</code></div><div class="doc"><div class="markdown"><p>If true (the default), the job is allowed to run concurrently within the current process. If false it will be forced to run sequentially. To disallow concurrent execution cluster wide make sure to also set the <code>:singleton</code> option. See <code><a href="immutant.scheduling.html#var-singleton">singleton</a></code>.</p></div></div><div class="src-link"><a href="https://github.com/immutant/immutant/tree/2.1.7/scheduling/src/immutant/scheduling.clj#L199">view source</a></div></div><div class="public anchor" id="var-at"><h3>at</h3><div class="usage"><code>(at date)</code><code>(at ms)</code><code>(at HHmm)</code><code>(at m v)</code></div><div class="doc"><div class="markdown"><p>Takes a time after which the job will fire, so it will run immediately if the time is in the past; can be a <code>java.util.Date</code>, millis-since-epoch, or a String in <code>HH:mm</code> format. See <code><a href="immutant.scheduling.html#var-schedule">schedule</a></code>.</p></div></div><div class="src-link"><a href="https://github.com/immutant/immutant/tree/2.1.7/scheduling/src/immutant/scheduling.clj#L162">view source</a></div></div><div class="public anchor" id="var-cron"><h3>cron</h3><div class="usage"><code>(cron str)</code><code>(cron m str)</code></div><div class="doc"><div class="markdown"><p>Takes a Quartz-style cron spec, e.g. <code>(cron &quot;0 0 12 ? * WED&quot;)</code>, see the <a href="http://quartz-scheduler.org/documentation/quartz-2.2.x/tutorials/tutorial-lesson-06">Quartz docs</a> for the syntax. See <code><a href="immutant.scheduling.html#var-schedule">schedule</a></code>.</p></div></div><div class="src-link"><a href="https://github.com/immutant/immutant/tree/2.1.7/scheduling/src/immutant/scheduling.clj#L188">view source</a></div></div><div class="public anchor" id="var-every"><h3>every</h3><div class="usage"><code>(every n)</code><code>(every kw)</code><code>(every m v)</code><code>(every n kw &amp; n-kws)</code><code>(every m n kw &amp; n-kws)</code></div><div class="doc"><div class="markdown"><p>Specifies a period between function calls, in milliseconds, a period keyword, or multiplier/keyword pairs, e.g. <code>(every 1 <code>:hour</code> 20 <code>:minutes</code>)</code>. Both singular and plural versions of <code>:second</code>, <code>:minute</code>, <code>:hour</code>, <code>:day</code>, and <code>:week</code> are valid period keywords. See <code><a href="immutant.scheduling.html#var-schedule">schedule</a></code>.</p></div></div><div class="src-link"><a href="https://github.com/immutant/immutant/tree/2.1.7/scheduling/src/immutant/scheduling.clj#L168">view source</a></div></div><div class="public anchor" id="var-id"><h3>id</h3><div class="usage"><code>(id str)</code><code>(id m str)</code></div><div class="doc"><div class="markdown"><p>Takes a String or keyword to use as the unique id for the job. See <code><a href="immutant.scheduling.html#var-schedule">schedule</a></code>.</p></div></div><div class="src-link"><a href="https://github.com/immutant/immutant/tree/2.1.7/scheduling/src/immutant/scheduling.clj#L205">view source</a></div></div><div class="public anchor" id="var-in"><h3>in</h3><div class="usage"><code>(in n)</code><code>(in kw)</code><code>(in m v)</code><code>(in n kw &amp; n-kws)</code><code>(in m n kw &amp; n-kws)</code></div><div class="doc"><div class="markdown"><p>Specifies the period after which the job will fire, in milliseconds, a period keyword, or multiplier/keyword pairs, e.g. <code>(in 5 <code>:minutes</code> 30 <code>:seconds</code>)</code>. See <code><a href="immutant.scheduling.html#var-every">every</a></code> for the list of valid  period keywords. See <code><a href="immutant.scheduling.html#var-schedule">schedule</a></code>.</p></div></div><div class="src-link"><a href="https://github.com/immutant/immutant/tree/2.1.7/scheduling/src/immutant/scheduling.clj#L156">view source</a></div></div><div class="public anchor" id="var-limit"><h3>limit</h3><div class="usage"><code>(limit n)</code><code>(limit m n)</code></div><div class="doc"><div class="markdown"><p>When <code><a href="immutant.scheduling.html#var-every">every</a></code> is specified, this limits the invocations by count, including the first one, e.g. <code>(-&gt; (every <code>:hour</code>) (limit 10))</code>. When combined with <code><a href="immutant.scheduling.html#var-until">until</a></code>, whichever triggers first ends the iteration. See <code><a href="immutant.scheduling.html#var-schedule">schedule</a></code>.</p></div></div><div class="src-link"><a href="https://github.com/immutant/immutant/tree/2.1.7/scheduling/src/immutant/scheduling.clj#L182">view source</a></div></div><div class="public anchor" id="var-schedule"><h3>schedule</h3><div class="usage"><code>(schedule f &amp; spec)</code></div><div class="doc"><div class="markdown"><p>Schedules a function to run according to a specification composed from any of the following:</p>
<ul>
  <li><code><a href="immutant.scheduling.html#var-in">in</a></code> - a period after which f will be called</li>
  <li><code><a href="immutant.scheduling.html#var-at">at</a></code> - a time after which f will be called</li>
  <li><code><a href="immutant.scheduling.html#var-every">every</a></code> - the period between calls</li>
  <li><code><a href="immutant.scheduling.html#var-until">until</a></code> - stops the calls at a specific time</li>
  <li><code><a href="immutant.scheduling.html#var-limit">limit</a></code> - limits the calls to a specific count</li>
  <li><code><a href="immutant.scheduling.html#var-cron">cron</a></code> - calls f according to a <a href="http://quartz-scheduler.org/documentation/quartz-2.2.x/tutorials/tutorial-lesson-06">Quartz-style</a> cron spec</li>
</ul><p>Units for periods are milliseconds, but can also be represented as a keyword or a sequence of multiplier/keyword pairs, e.g. <code>[1 <code>:week</code>, 4 <code>:days</code>, 2 <code>:hours</code>, 30 <code>:minutes</code>, 59 <code>:seconds</code>]</code>. See <code><a href="immutant.scheduling.html#var-every">every</a></code> for the list of valid period keywords.</p><p>Time values can be a <code>java.util.Date</code>, a long denoting milliseconds-since-epoch, or a String in <code>HH:mm</code> format, interpreted as the next occurence of &ldquo;HH:mm:00&rdquo; in the currently active timezone.</p><p>For example:</p>
<pre><code>(schedule #(prn &#39;fire!)
  (-&gt; (in 5 <code>:minutes</code>)
    (every 2 <code>:hours</code>, 30 <code>:minutes</code>)
    (until &quot;1730&quot;)))

(schedule #(prn &#39;fire!)
  (-&gt; (at some-date)
    (every <code>:second</code>)
    (limit 60)))
</code></pre><p>Ultimately, the spec is just a map, and the syntactic sugar functions are just assoc&rsquo;ing keys corresponding to their names. The map can be passed either explicitly or via keyword arguments. All of the following are equivalent:</p>
<pre><code>(schedule #(prn &#39;fire!) (-&gt; (in 5 <code>:minutes</code>) (every <code>:day</code>)))
(schedule #(prn &#39;fire!) {<code>:in</code> [5 <code>:minutes</code>], <code>:every</code> <code>:day</code>})
(schedule #(prn &#39;fire!) <code>:in</code> [5 <code>:minutes</code>], <code>:every</code> <code>:day</code>)
</code></pre><p>Three additional options may be passed in the spec:</p>
<ul>
  <li><code>:id</code> - a unique identifier for the scheduled job</li>
  <li><code>:singleton</code> - denotes the job&rsquo;s behavior in a cluster. If truthy, an <code>:id</code> as required. The  given value will be used as the <code>:id</code> if it is truthy but not <code>true</code> and <code>:id</code> isn&rsquo;t specified [false]</li>
  <li><code>:allow-concurrent-exec?</code> - a boolean denoting the job&rsquo;s concurrency behavior in the current process [true]</li>
</ul><p>If called with an <code>:id</code> that has already been scheduled, the prior job will be replaced. If an id is not provided, a UUID is used instead.</p><p>If <code>:allow-concurrent-exec?</code> is true, a job that fires while a previous invocation is running will also run, assuming a worker thread is available.</p><p>The return value is a map of the options with any missing defaults filled in, including a generated id if necessary.</p><p>You can pass additional options that will be passed on to the scheduler. Currently, the only scheduler option is:</p>
<ul>
  <li><code>:num-threads</code> Specifies the number of worker threads for the scheduler&rsquo;s  thread pool [5]</li>
</ul><p>The scheduler options also define which scheduler to use, so if you don&rsquo;t pass any with a <code>schedule</code> call, you&rsquo;ll get the default scheduler configured with the default options. If you pass scheduler options on a subsequent call, you will get a different scheduler configured with those options. The same scheduler will be used for any future <code>schedule</code> calls with those same scheduler options.</p><p>If you need to capture any bindings in effect when the job is scheduled, wrap <code>f</code> in a call to <code>bound-fn</code>.</p></div></div><div class="src-link"><a href="https://github.com/immutant/immutant/tree/2.1.7/scheduling/src/immutant/scheduling.clj#L26">view source</a></div></div><div class="public anchor" id="var-singleton"><h3>singleton</h3><div class="usage"><code>(singleton boolean-or-id)</code><code>(singleton m boolean-or-id)</code></div><div class="doc"><div class="markdown"><p>If truthy (false by default), only one instance of a given job name will run in a cluster. If truthy, an <code>:id</code> as required. The given value will be used as the <code>:id</code> if it is truthy but not <code>true</code> and <code>:id</code> isn&rsquo;t specified. See <code><a href="immutant.scheduling.html#var-schedule">schedule</a></code>.</p></div></div><div class="src-link"><a href="https://github.com/immutant/immutant/tree/2.1.7/scheduling/src/immutant/scheduling.clj#L193">view source</a></div></div><div class="public anchor" id="var-stop"><h3>stop</h3><div class="usage"><code>(stop &amp; options)</code></div><div class="doc"><div class="markdown"><p>Unschedule a scheduled job.</p><p>Options can be passed as either a map or kwargs, but is typically the map returned from a <code><a href="immutant.scheduling.html#var-schedule">schedule</a></code> call. If no options are passed, all jobs for the default scheduler are stopped. If there are no jobs remaining on the scheduler the scheduler itself is stopped. Returns true if a job was actually removed.</p></div></div><div class="src-link"><a href="https://github.com/immutant/immutant/tree/2.1.7/scheduling/src/immutant/scheduling.clj#L129">view source</a></div></div><div class="public anchor" id="var-until"><h3>until</h3><div class="usage"><code>(until date)</code><code>(until ms)</code><code>(until HHmm)</code><code>(until m v)</code></div><div class="doc"><div class="markdown"><p>When <code><a href="immutant.scheduling.html#var-every">every</a></code> is specified, this limits the invocations by time; can be a <code>java.util.Date</code>, millis-since-epoch, or a String in <code>HH:mm</code> format, e.g. <code>(-&gt; (every <code>:hour</code>) (until &quot;17:00&quot;))</code>. When combined with <code><a href="immutant.scheduling.html#var-limit">limit</a></code>, whichever triggers first ends the iteration. See <code><a href="immutant.scheduling.html#var-schedule">schedule</a></code>.</p></div></div><div class="src-link"><a href="https://github.com/immutant/immutant/tree/2.1.7/scheduling/src/immutant/scheduling.clj#L175">view source</a></div></div></div></body></html>