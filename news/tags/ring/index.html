<!DOCTYPE html>
<html>
  <head>
    <title>
      Immutant | News
    </title>
    <meta charset="UTF-8">
    <meta content="width=device-width, initial-scale=1.0" name="viewport">
    <link href="/stylesheets/styles.css" rel="stylesheet" type="text/css">
    <!--[if lt IE 9]>
      <script src="//html5shim.googlecode.com/svn/trunk/html5.js" type="text/javascript"></script>
    <![endif]-->
    <link href="/news.atom" rel="alternate" type="application/atom+xml">
    <script src="//cdnjs.cloudflare.com/ajax/libs/jquery/1.7.1/jquery.min.js" type="text/javascript"></script>
    <script src="/javascripts/dateformat.js" type="text/javascript"></script>
  </head>
  <body>
    <div class="navbar navbar-fixed-top">
      <div class="navbar-inner">
        <div class="container">
          <a class="brand" href="/">
            <img id="logo" src="/images/logos/logo-horizontal-centered.png">
          </a>
          <a class="btn btn-navbar" data-target=".nav-collapse" data-toggle="collapse">
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </a>
          <div class="nav-collapse">
            <ul class="nav">
              <li>
                <a href="/news/">News</a>
              </li>
              <li>
                <a href="/documentation/">Documentation</a>
              </li>
              <li>
                <a href="/community/">Community</a>
              </li>
              <li>
                <a href="/development/">Development</a>
              </li>
              <li class="dropdown">
                <a class="dropdown-toggle" data-toggle="dropdown" href="#">
                  Quick Links
                  <b class="caret"></b>
                </a>
                <ul class="dropdown-menu">
                  <li>
                    <a href="/documentation/current/apidoc/">2.x API Docs & Guides</a>
                  </li>
                  <li>
                    <a href="/builds/2x/">2.x Incremental Builds</a>
                  </li>
                  <li class="divider"></li>
                  <li>
                    <a href="/documentation/1.1.4/" rel="nofollow">1.x Manual</a>
                  </li>
                  <li>
                    <a href="/documentation/1.1.4/apidoc/" rel="nofollow">1.x API Docs</a>
                  </li>
                  <li>
                    <a href="/tutorials-1x/" rel="nofollow">1.x Tutorials</a>
                  </li>
                  <li>
                    <a href="/builds/" rel="nofollow">1.x Incremental Builds</a>
                  </li>
                  <li class="divider"></li>
                  <li>
                    <a href="/releases/">All Versioned Releases</a>
                  </li>
                  <li>
                    <a href="https://issues.jboss.org/browse/IMMUTANT">Issues</a>
                  </li>
                  <li>
                    <a href="http://webchat.freenode.net/?channels=immutant">#immutant on IRC</a>
                  </li>
                  <li>
                    <a href="https://github.com/immutant/immutant">Source</a>
                  </li>
                </ul>
              </li>
            </ul>
          </div>
        </div>
      </div>
    </div>
    <div id="wrapper">
      <div class="container" id="main-content">
        <div class="page-header">
          <h1>
            News
          </h1>
        </div>
        <div class="row">
          <div class="span8" id="main-column">
            <div class="post">
              <h2 class="title">
                <a href="/news/2013/08/20/openshift-clustering/">Clustering Immutants on OpenShift</a>
              </h2>
              <div class="byline">
                <div class="author">
                  Jim Crossley
                </div>
                <div class="date">
                  Tuesday, August 20, 2013
                </div>
              </div>
              <div class="tags">
                <a href="/news/tags/openshift/">openshift</a>
                <a href="/news/tags/tutorial/">tutorial</a>
                <a href="/news/tags/clustering/">clustering</a>
                <a href="/news/tags/messaging/">messaging</a>
                <a href="/news/tags/caching/">caching</a>
                <a href="/news/tags/daemons/">daemons</a>
                <a href="/news/tags/scheduled-jobs/">scheduled-jobs</a>
                <a href="/news/tags/ring/">ring</a>
              </div>
              <div class="body">
                <p>Lately I&#39;ve been spending a lot of time on <a href="http://openshift.com/">OpenShift</a>, building and
                testing a <a href="https://www.openshift.com/developers/technologies">cartridge</a> for Immutant that will properly form a cluster
                across multiple OpenShift <a href="https://www.openshift.com/products/pricing">gears</a>. In this post, I&#39;ll go through the steps
                of deploying a simple application that demonstrates all of the
                Immutant clustering features running on the three small gears you get
                for free on OpenShift.</p>
                
                <p>Here are the features we&#39;ll be demonstrating:</p>
                
                <ul>
                <li>Load-balanced message distribution with automatic peer discovery</li>
                <li>Replicated caching</li>
                <li>Highly-Available, long-running daemons</li>
                <li>HA scheduled jobs</li>
                <li>Web load balancing and session replication</li>
                </ul>
                
                <p>If you haven&#39;t already, go <a href="https://www.openshift.com/get-started#cli">set up an OpenShift account</a> and update
                your <code>rhc</code> gem to the latest version. I used 1.12.4 for this article.
                Below you&#39;ll see references to <em>$namespace</em> -- this corresponds to
                your OpenShift domain name, set by running <code>rhc setup</code>.</p>
                
                <p><em>Note</em>: If this is the first time you&#39;ve used OpenShift, you&#39;ll need
                to visit the <a href="https://openshift.redhat.com/app/console">console</a> and accept the usage agreement before running
                the <code>rhc</code> command.</p>
                
                <h2 id="Create_a_scaled_OpenShift_app" onclick="window.location = '#Create_a_scaled_OpenShift_app'">Create a scaled OpenShift app</h2>
                
                <p>The Immutant cartridge is available here:
                <a href="https://github.com/immutant/openshift-immutant-cart">https://github.com/immutant/openshift-immutant-cart</a>. As described in
                its README, we create our app using the following command:</p>
                
                <pre><code>rhc app-create -s demo https://raw.github.com/immutant/openshift-immutant-cart/master/metadata/manifest.yml&#x000A;</code></pre>
                
                <p>We&#39;re calling our app <em>demo</em> and we&#39;re passing the <code>-s</code> option to
                make our app scalable. Notice that we&#39;re passing a raw URL to the
                cartridge&#39;s <code>manifest.yml</code>.</p>
                
                <p>Small gears are pretty slow, but when <code>app-create</code> finally completes,
                you&#39;ll have a bare-bones, standard Leiningen application beneath the
                <code>demo/</code> directory. At this point, you might tail your app&#39;s logs or
                ssh into your gear:</p>
                
                <pre><code>rhc tail demo&#x000A;rhc ssh demo&#x000A;</code></pre>
                
                <p>The critical log file for Immutant on OpenShift is
                <code>immutant/logs/server.log</code>. Monitor this file until you eventually see
                the line, <em>Deployed &quot;your-clojure-application.clj&quot;</em>. Then point a
                browser at <a href="http://demo-$namespace.rhcloud.com">http://demo-$namespace.rhcloud.com</a> to see a simple
                welcome page.</p>
                
                <p>Now we&#39;ll put some meat on our bare-bones app!</p>
                
                <h2 id="Push_Me,_Pull_You" onclick="window.location = '#Push_Me,_Pull_You'">Push Me, Pull You</h2>
                
                <p>Typically, you will add the remote git repository for your real
                application to the local OpenShift repository you just created. We&#39;re
                going to use <a href="https://github.com/immutant/cluster-demo">https://github.com/immutant/cluster-demo</a> as our &quot;real&quot;
                application.</p>
                
                <pre><code>git remote add upstream -m master git@github.com:immutant/cluster-demo.git&#x000A;</code></pre>
                
                <p>Deployment of your app to OpenShift amounts to pulling from your real
                repository and pushing to OpenShift&#39;s.</p>
                
                <pre><code>git pull -s recursive -X theirs upstream master&#x000A;git push&#x000A;</code></pre>
                
                <p>While waiting for that to complete, run <code>rhc tail demo</code> in another
                shell to monitor your log. This time, the <em>Deployed
                &quot;your-clojure-application.clj&quot;</em> message is going to scroll off the
                screen as the cluster-demo app starts logging its output. Eventually,
                the app should settle into a steady state looking something like this:</p>
                
                <p><img src="/images/news/demo-log.png"/></p>
                
                <h2 id="The_cluster-demo_app" onclick="window.location = '#The_cluster-demo_app'">The cluster-demo app</h2>
                
                <p>If you can ignore the inconsistent thread identifiers in the above
                output, you&#39;ll notice there are exactly four types of messages:
                <strong>send</strong>, <strong>recv</strong>, <strong>web</strong>, and <strong>job</strong>. Noting the timestamps in the
                left column, a <strong>send</strong> is logged every 5 seconds, as is its
                corresponding <strong>recv</strong>, a <strong>web</strong> logged every 2 seconds, and a
                <strong>job</strong> every 20 seconds.</p>
                
                <p>The cluster-demo app is comprised of the following:</p>
                
                <ul>
                <li>A message queue named <em>/queue/msg</em></li>
                <li>A distributed cache named <em>counters</em></li>
                <li>A listener for the queue that prints the received message and the
                current contents of the cache</li>
                <li>An HA daemon named <em>counter</em> that queues a cached value and
                increments it every 5 seconds</li>
                <li>An HA scheduled job named <em>ajob</em> that increments another counter in
                the cache every 20 seconds</li>
                <li>A web request handler mounted at <strong>/</strong> that logs its <code>:path-info</code>
                and returns the current values of the two cached counters</li>
                <li>Another request handler mounted at <strong>/count</strong> that increments a
                counter in the user&#39;s web session.</li>
                </ul>
                
                <p>All the code (~60 lines) is <a href="https://github.com/immutant/cluster-demo/blob/master/src/immutant/init.clj">contained in a single file</a>.</p>
                
                <h2 id="Programming_is_hard,_let&#39;s_build_a_cluster!" onclick="window.location = '#Programming_is_hard,_let&#39;s_build_a_cluster!'">Programming is hard, let&#39;s build a cluster!</h2>
                
                <p>Now we&#39;re ready to form a cluster by adding a gear to our app:</p>
                
                <pre><code>rhc scale-cartridge immutant -a demo 2&#x000A;</code></pre>
                
                <p>Again, this will take a few minutes, and it may return an error even
                though the operation actually succeeded. You can run the following to
                see the definitive state of your gears:</p>
                
                <pre><code>rhc show-app --gears&#x000A;</code></pre>
                
                <p>This also gives you the SSH URLs for your two gears. Fire up two
                shells and ssh into each of your gears using those SSH URLs. Then
                tail the log on each:</p>
                
                <pre><code>tail -f immutant/logs/server.log&#x000A;</code></pre>
                
                <p>When the dust settles, you&#39;ll eventually see the gears discover each
                other, and you should see both gears logging <strong>recv</strong> messages, one
                getting the even numbers and one getting the odd. This is your
                automatic load-balanced message distribution. </p>
                
                <p>Note also that the counters cache logged in the <strong>recv</strong> message is
                correct on both gears, even though it&#39;s only being updated by one.
                This is our cache replication at work.</p>
                
                <h2 id="Let&#39;s_break_stuff!" onclick="window.location = '#Let&#39;s_break_stuff!'">Let&#39;s break stuff!</h2>
                
                <p>And see how robust our cluster is.</p>
                
                <h3 id="High_Availability_Daemons_and_Jobs" onclick="window.location = '#High_Availability_Daemons_and_Jobs'">High Availability Daemons and Jobs</h3>
                
                <p>Of course, the <strong>send</strong> and <strong>job</strong> log entries should still only
                appear on our original gear, because those are our HA singletons. If
                that gear crashes, our daemon and job should migrate to the other
                gear. While logged into the gear running your singletons, run this:</p>
                
                <pre><code>immutant/bin/control stop&#x000A;</code></pre>
                
                <p>And watch the other gear&#39;s log to verify the daemon and job pick up
                right where they left off, fetching their counters from the replicated
                cache. That gear should be consuming all the queued messages, too. Now
                start the original gear back up:</p>
                
                <pre><code>immutant/bin/control start&#x000A;</code></pre>
                
                <p>Eventually, it&#39;ll start receiving half the messages again.</p>
                
                <h3 id="Web" onclick="window.location = '#Web'">Web</h3>
                
                <p>You may be wondering about those <strong>web</strong> entries showing up in both
                logs. They are &quot;health check&quot; requests from the <a href="https://www.openshift.com/blogs/how-haproxy-scales-openshift-apps">HAProxy</a> web load
                balancer, automatically installed on your primary gear. You can always
                check the state of your cluster from HAProxy&#39;s perspective by visiting
                <a href="http://demo-$namespace.rhcloud.com/haproxy-status">http://demo-$namespace.rhcloud.com/haproxy-status</a>. If you see that
                page without intending to, it means something about your app is
                broken, so check <code>immutant/logs/server.log</code> for errors and make sure
                your app responds to a request for the root context, i.e. &quot;/&quot;.</p>
                
                <p>Let&#39;s try some web stuff. Use curl to hit your app while observing the
                logs on both gears:</p>
                
                <pre><code>curl http://demo-$namespace.rhcloud.com/xxxxxxxxxxxxxxxxxxxx&#x000A;curl http://demo-$namespace.rhcloud.com/yyyyyyyyyyyyyyyyyyyy&#x000A;curl http://demo-$namespace.rhcloud.com/zzzzzzzzzzzzzzzzzzzz&#x000A;</code></pre>
                
                <p>Use an obnoxious path to distinguish your request from the health
                checks. Repeat the command a few times to observe the gears taking
                turns responding to your request. Now try it in a browser, and you&#39;ll
                see the same gear handling your request every time you reload. This is
                because HAProxy is setting cookies in the response to enable session
                affinity, which your browser is probably sending back. And <code>curl</code>
                didn&#39;t.</p>
                
                <p>Speaking of session affinity, let&#39;s break that while we&#39;re at it, by
                invoking our other web handler, the one that increments a counter in
                the user&#39;s web session: <a href="http://demo-$namespace.rhcloud.com/count">http://demo-$namespace.rhcloud.com/count</a></p>
                
                <p>You should see the counter increment each time you reload your
                browser. (You&#39;ll need to give <code>curl</code> a cookie store to see it respond
                with anything other than &quot;1 times&quot;)</p>
                
                <p>Pay attention to which gear is responding to the <em>/count</em> request. Now
                stop that gear like you did before. When you reload your browser, you
                should see the other gear return the expected value. This is the
                automatic session replication provided by
                <code>immutant.web.session/servlet-store</code>.</p>
                
                <p>Don&#39;t forget to restart that gear.</p>
                
                <h2 id="The_Hat_Trick" onclick="window.location = '#The_Hat_Trick'">The Hat Trick</h2>
                
                <p>Hey, OpenShift is giving us 3 free gears, we may as well use &#39;em all,
                right?</p>
                
                <pre><code>rhc scale-cartridge immutant -a demo 3&#x000A;</code></pre>
                
                <p>When the third one finally comes up, there are a couple of things you
                may notice:</p>
                
                <ul>
                <li>The health checks will disappear from the primary gear as HAProxy
                takes it out of the rotation when 2 or more other gears are
                available, ostensibly to mitigate the <a href="http://en.wikipedia.org/wiki/Observer_effect_(information_technology)">observer effect</a> of the
                health checks.</li>
                <li>Each cache key will only show up in the <strong>recv</strong> log messages on 2
                of the 3 gears. This is because Immutant caches default to
                Infinispan&#39;s <code>:distributed</code> replication mode in a cluster. This
                enables Infinispan clusters to achieve &quot;linear scalability&quot; as
                entries are copied to a fixed number of cluster nodes (default 2)
                regardless of the cluster size. Distribution uses a consistent
                hashing algorithm to determine which nodes will store a given entry.</li>
                </ul>
                
                <h2 id="Now_what?" onclick="window.location = '#Now_what?'">Now what?</h2>
                
                <p>Well, that was a lot to cover. I doubt many apps will use all these
                features, but I think it&#39;s nice to have a free playground on which to
                try them out, even with the resources as constrained as they are on a
                small gear.</p>
                
                <p>Regardless, I&#39;m pretty happy that Immutant is finally feature-complete
                on OpenShift now. :-)</p>
                
                <p>Of course, I had a lot of help getting things to this point. Many
                folks on the OpenShift and JBoss teams were generous with their
                expertise, but the &quot;three B&#39;s&quot; deserve special mention:
                <a href="https://twitter.com/bbrowning">Ben</a>,
                <a href="http://belaban.blogspot.com/">Bela</a>, and
                <a href="http://www.billdecoste.net/">Bill</a>.</p>
                
                <p>Thanks!</p>
              </div>
              <div class="tail">
                 <a href="http://immutant.org/news/2013/08/20/openshift-clustering/#disqus_thread">Comments</a>
                <hr>
              </div>
            </div>
            <div class="post">
              <h2 class="title">
                <a href="/news/2011/11/08/deploying-an-application/">Getting Started: Deploying a Web Application</a>
              </h2>
              <div class="byline">
                <div class="author">
                  Toby Crawley
                </div>
                <div class="date">
                  Tuesday, November  8, 2011
                </div>
              </div>
              <div class="tags">
                <a href="/news/tags/lein/">lein</a>
                <a href="/news/tags/deploy/">deploy</a>
                <a href="/news/tags/tutorial/">tutorial</a>
                <a href="/news/tags/getting-started/">getting-started</a>
                <a href="/news/tags/ring/">ring</a>
              </div>
              <div class="body">
                <p>Welcome back! This article covers creating a basic <a href="https://github.com/mmcgrana/ring">Ring</a> web application and deploying 
                to an Immutant. It is the second installment in a 
                <a href="/news/tags/getting-started/">series of tutorials on getting started</a> with Immutant. If you haven&#39;t
                read the <a href="/news/2011/11/08/installing/">first installment</a>, go do so now, since it covers installation
                and setup. This tutorial assumes you are on a *nix system.</p>
                
                <h2 id="Creating_an_Immutant_Clojure_application" onclick="window.location = '#Creating_an_Immutant_Clojure_application'">Creating an Immutant Clojure application</h2>
                
                <p>In our <a href="/news/2011/11/08/installing/">previous article</a>, we installed the <a href="https://github.com/immutant/lein-immutant/">lein plugin</a>. Let&#39;s take another
                look at the tasks it provides:</p>
                
                <pre><code>~/immutant $ lein immutant&#x000A;Manage the deployment lifecycle of an Immutant application.&#x000A;&#x000A;Subtasks available:&#x000A;new        Create a new project skeleton initialized for immutant.&#x000A;init       Adds a sample immutant.clj configuration file to an existing project&#x000A;deploy     Deploys the current project to the Immutant specified by $IMMUTANT_HOME&#x000A;undeploy   Undeploys the current project from the Immutant specified by $IMMUTANT_HOME&#x000A;run        Starts up the Immutant specified by $IMMUTANT_HOME, displaying its console output&#x000A;</code></pre>
                
                <p>We talked about <code>run</code> last time. This time, we&#39;ll cover <code>new</code> and <code>deploy</code>. To do so, 
                we&#39;ll build a basic application that demonstrates the current web features. To get
                started, let&#39;s create an Immutant project:</p>
                
                <pre><code>~/immutant $ lein immutant new immutant-demo&#x000A;Created new project in: /Users/tobias/immutant/immutant-demo&#x000A;Look over project.clj and start coding in immutant_demo/core.clj&#x000A;Wrote sample immutant.clj&#x000A;</code></pre>
                
                <p>The <code>new</code> task creates a <a href="https://github.com/technomancy/leiningen">Leiningen</a> project and gives it a sample Immutant configuration
                file (<code>immutant.clj</code>). It is equivalent to calling:</p>
                
                <pre><code>~/immutant $ lein new immutant-demo &amp;&amp; cd immutant-demo &amp;&amp; lein immutant init&#x000A;</code></pre>
                
                <p>We&#39;ll come back to <code>immutant.clj</code> in a sec. Now, let&#39;s add a ring handler to our core namespace:</p>
                
                <pre class="syntax clojure">(ns immutant-demo.core)&#x000A;&#x000A;(defn ring-handler [request]&#x000A;  {:status 200&#x000A;    :headers {"Content-Type" "text/html"}&#x000A;    :body "Hello from Immutant!" })</pre>
                
                <h2 id="Configuring_the_application_for_Immutant" onclick="window.location = '#Configuring_the_application_for_Immutant'">Configuring the application for Immutant</h2>
                
                <p>When the Immutant deploys an application, it looks for a file named <code>immutant.clj</code> 
                at the root and evaluates it if it exists. This file is used to configure the
                Immutant services you want your application to consume. It&#39;s the single place you 
                defines all the components required by your application, and saves you from having to
                keep external configuration files in sync (crontabs, message queue definitions, init scripts, etc).</p>
                
                <p>The file has example code for configuring web endpoints and messaging services, but we&#39;re
                just going to deal with web endpoints in this article. Edit your <code>immutant.clj</code> so it 
                looks like:</p>
                
                <pre class="syntax clojure">(ns immutant-demo.init&#x000A;  (:use immutant-demo.core)&#x000A;  (:require [immutant.messaging :as messaging]&#x000A;            [immutant.web :as web]))&#x000A;&#x000A;(web/start "/" #'ring-handler)</pre>
                
                <p>We&#39;ll come back to what <code>web/start</code> is doing after we get the application running.</p>
                
                <h2 id="Deploying_your_application" onclick="window.location = '#Deploying_your_application'">Deploying your application</h2>
                
                <p>Before we can start up an Immutant, we need to tell it about our application. We do that
                by deploying (for this to work, you need to have <code>IMMUTANT_HOME</code> set - see the 
                <a href="/news/2011/11/08/installing/">previous article</a> for details):</p>
                
                <pre><code>~/immutant/immutant-demo $ lein immutant deploy&#x000A;Deployed immutant-demo to /Users/tobias/immutant/current/jboss/standalone/deployments/immutant-demo.clj&#x000A;</code></pre>
                
                <p>This writes a <em>deployment descriptor</em> to Immutant&#39;s deploy directory which points back
                to the application&#39;s root directory. Now the Immutant can find your application - so let&#39;s 
                fire it up.</p>
                
                <h2 id="Starting_Immutant" onclick="window.location = '#Starting_Immutant'">Starting Immutant</h2>
                
                <p>To launch an Immutant, use the <code>lein immutant run</code> command. This will
                start the Immutant&#39;s JBoss server, and will run in the foreground displaying the console log.
                You&#39;ll see lots of log messages that you can ignore - the
                one to look for should be the last message, and should tell you the app was deployed:</p>
                
                <pre><code>~/immutant/immutant-demo $ lein immutant run&#x000A;Starting Immutant via /Users/tobias/immutant/current/jboss/bin/standalone.sh&#x000A;...&#x000A;(a plethora of log messages deleted)&#x000A;...&#x000A;13:04:39,888 INFO  [org.jboss.as.server.controller] (DeploymentScanner-threads - 2) Deployed &quot;immutant-demo.clj&quot;&#x000A;</code></pre>
                
                <p>Now, let&#39;s verify that our app is really there. Immutant runs on port 8080 by default, so 
                let&#39;s hit it and see what happens:</p>
                
                <pre><code>~ $ curl http://localhost:8080/immutant-demo/&#x000A;Hello from Immutant!&#x000A;</code></pre>
                
                <p>Yay!</p>
                
                <p>You can kill the Immutant with Ctrl-C.</p>
                
                <h2 id="Context_Paths" onclick="window.location = '#Context_Paths'">Context Paths</h2>
                
                <p>Remember our call to <code>web/start</code> earlier? Let&#39;s talk about what that is doing. To 
                do that, however, we need to first talk about <em>context paths</em>. The context path is 
                the portion of the URL between the hostname and the routes within the application.
                It basically tells Immutant which requests to route to a particular application.</p>
                
                <p>An Immutant can host multiple applications at the same time, but each application must 
                have a unique context path. If no context path is provided when an application
                is deployed, it defaults to one based on the name of the deployment. The 
                deployment name is taken from the name of the deployment descriptor, which
                in turn is taken from the name of the project given to <code>defproject</code> in
                <code>project.clj</code>. So for our sample app above, the context path defaults to 
                <code>/immutant-demo</code>. You can override this default by specifying
                a <code>:context-path</code> within an <code>:immutant</code> map in your <code>project.clj</code>. Let&#39;s
                go ahead and do that:</p>
                
                <pre class="syntax clojure">(defproject immutant-demo "1.0.0-SNAPSHOT"&#x000A;  :description "A basic demo"&#x000A;  :dependencies [[org.clojure/clojure "1.2.1"]]&#x000A;  :immutant {:context-path "/"})</pre>
                
                <p>Now, when you call <code>lein immutant deploy</code>, the context path will be picked up
                from your <code>project.clj</code> and included in the deployment descriptor and any
                web endpoints your application stands up will be accessible under that
                context path.</p>
                
                <p>Which brings us back to <code>web/start</code>. <code>web/start</code> stands up a web endpoint
                for you, and takes two arguments: a <em>sub-context path</em> and a <a href="https://github.com/mmcgrana/ring">Ring</a> handler
                function. The sub-context path is relative to the application&#39;s context
                path, so a context path of &quot;/ham&quot; and a sub-context path of &quot;/&quot; makes
                the handler function available at <code>/ham</code>, whereas a sub-context path
                of &quot;/biscuits&quot; makes the handler function available at <code>/ham/biscuits</code>.
                Make sense?</p>
                
                <p>You can register as many web endpoints as you like within an application -
                they just each need an application unique sub-context path. If we add 
                this to our <code>core.clj</code>:</p>
                
                <pre class="syntax clojure">(defn another-ring-handler [request]&#x000A;  {:status 200&#x000A;   :headers {"Content-Type" "text/html"}&#x000A;   :body "Pssst! Over here!"})</pre>
                
                <p>And this to our <code>immutant.clj</code>:</p>
                
                <pre class="syntax clojure">(web/start "/biscuits" #'another-ring-handler)</pre>
                
                <p>Redeploy the application to pick up the <code>:context-path</code> from <code>immutant.clj</code>:</p>
                
                <pre><code>~/immutant/immutant-demo $ lein immutant deploy&#x000A;Deployed immutant-demo to /Users/tobias/immutant/current/jboss/standalone/deployments/immutant-demo.clj&#x000A;</code></pre>
                
                <p>Then fire an Immutant up again with <code>lein immutant run</code>, we can see they
                both work:</p>
                
                <pre><code>~ $ curl http://localhost:8080&#x000A;Hello from Immutant!&#x000A;~ $ curl http://localhost:8080/biscuits&#x000A;Pssst! Over here!&#x000A;</code></pre>
                
                <p><code>web/start</code> has a companion function for shutting down a web endpoint:
                <code>web/stop</code>. It takes the sub-context path for the endpoint, and can
                be called from anywhere. You aren&#39;t required to shut down your endpoints -
                Immutant will do that on your behalf when it is shut down or the application 
                is undeployed.</p>
                
                <h2 id="Wrapping_up" onclick="window.location = '#Wrapping_up'">Wrapping up</h2>
                
                <p>I hope you&#39;ve enjoyed this quick run-through of deploying a web application
                to Immutant. Since Immutant is still in a pre-alpha state, none of what I
                said above is set in stone. If anything does change, I&#39;ll edit this post
                to keep it accurate. I&#39;ve posted the <a href="https://github.com/immutant/immutant-basic-web-demo">demo application</a> we&#39;ve built if you want
                to download it. </p>
                
                <p>If you have any feedback or questions, <a href="/community">get in touch</a>! And stay tuned - our next 
                tutorial will cover using Immutant&#39;s messaging features. </p>
              </div>
              <div class="tail">
                 <a href="http://immutant.org/news/2011/11/08/deploying-an-application/#disqus_thread">Comments</a>
                <hr>
              </div>
            </div>
            <div class="pagination-links"><span class="current-page">1</span> </div>
          </div>
          <div class="span4" id="sidebar-column">
            <div class="tags">
              <div class="tag-cloud">
                <span class="tag tag-0">
                  <a href="http://immutant.org/news/tags/announcement/">announcement</a>
                </span>
                <span class="tag tag-1">
                  <a href="http://immutant.org/news/tags/app-server/">app-server</a>
                </span>
                <span class="tag tag-0">
                  <a href="http://immutant.org/news/tags/bears/">bears</a>
                </span>
                <span class="tag tag-0">
                  <a href="http://immutant.org/news/tags/beginning/">beginning</a>
                </span>
                <span class="tag tag-1">
                  <a href="http://immutant.org/news/tags/boot/">boot</a>
                </span>
                <span class="tag tag-0">
                  <a href="http://immutant.org/news/tags/boot-immutant/">boot-immutant</a>
                </span>
                <span class="tag tag-1">
                  <a href="http://immutant.org/news/tags/caching/">caching</a>
                </span>
                <span class="tag tag-1">
                  <a href="http://immutant.org/news/tags/clustering/">clustering</a>
                </span>
                <span class="tag tag-1">
                  <a href="http://immutant.org/news/tags/daemons/">daemons</a>
                </span>
                <span class="tag tag-1">
                  <a href="http://immutant.org/news/tags/datomic/">datomic</a>
                </span>
                <span class="tag tag-0">
                  <a href="http://immutant.org/news/tags/deploy/">deploy</a>
                </span>
                <span class="tag tag-0">
                  <a href="http://immutant.org/news/tags/distribution/">distribution</a>
                </span>
                <span class="tag tag-1">
                  <a href="http://immutant.org/news/tags/enterprise/">enterprise</a>
                </span>
                <span class="tag tag-1">
                  <a href="http://immutant.org/news/tags/event/">event</a>
                </span>
                <span class="tag tag-0">
                  <a href="http://immutant.org/news/tags/first/">first</a>
                </span>
                <span class="tag tag-2">
                  <a href="http://immutant.org/news/tags/getting-started/">getting-started</a>
                </span>
                <span class="tag tag-0">
                  <a href="http://immutant.org/news/tags/hotrod/">hotrod</a>
                </span>
                <span class="tag tag-1">
                  <a href="http://immutant.org/news/tags/infinispan/">infinispan</a>
                </span>
                <span class="tag tag-2">
                  <a href="http://immutant.org/news/tags/installation/">installation</a>
                </span>
                <span class="tag tag-0">
                  <a href="http://immutant.org/news/tags/isolation/">isolation</a>
                </span>
                <span class="tag tag-2">
                  <a href="http://immutant.org/news/tags/lein/">lein</a>
                </span>
                <span class="tag tag-1">
                  <a href="http://immutant.org/news/tags/lein-immutant/">lein-immutant</a>
                </span>
                <span class="tag tag-0">
                  <a href="http://immutant.org/news/tags/luminus/">luminus</a>
                </span>
                <span class="tag tag-2">
                  <a href="http://immutant.org/news/tags/messaging/">messaging</a>
                </span>
                <span class="tag tag-1">
                  <a href="http://immutant.org/news/tags/openshift/">openshift</a>
                </span>
                <span class="tag tag-1">
                  <a href="http://immutant.org/news/tags/overlay/">overlay</a>
                </span>
                <span class="tag tag-0">
                  <a href="http://immutant.org/news/tags/pipelines/">pipelines</a>
                </span>
                <span class="tag tag-1">
                  <a href="http://immutant.org/news/tags/polyglot/">polyglot</a>
                </span>
                <span class="tag tag-0">
                  <a href="http://immutant.org/news/tags/poorsmatic/">poorsmatic</a>
                </span>
                <span class="tag tag-0">
                  <a href="http://immutant.org/news/tags/postgresql/">postgresql</a>
                </span>
                <span class="tag tag-1">
                  <a href="http://immutant.org/news/tags/presentations/">presentations</a>
                </span>
                <span class="tag tag-6">
                  <a href="http://immutant.org/news/tags/releases/">releases</a>
                </span>
                <span class="tag tag-1">
                  <a href="http://immutant.org/news/tags/ring/">ring</a>
                </span>
                <span class="tag tag-0">
                  <a href="http://immutant.org/news/tags/runtime/">runtime</a>
                </span>
                <span class="tag tag-1">
                  <a href="http://immutant.org/news/tags/scheduled-jobs/">scheduled-jobs</a>
                </span>
                <span class="tag tag-0">
                  <a href="http://immutant.org/news/tags/scheduling/">scheduling</a>
                </span>
                <span class="tag tag-0">
                  <a href="http://immutant.org/news/tags/screencast/">screencast</a>
                </span>
                <span class="tag tag-0">
                  <a href="http://immutant.org/news/tags/slim/">slim</a>
                </span>
                <span class="tag tag-1">
                  <a href="http://immutant.org/news/tags/sockjs/">sockjs</a>
                </span>
                <span class="tag tag-1">
                  <a href="http://immutant.org/news/tags/survey/">survey</a>
                </span>
                <span class="tag tag-1">
                  <a href="http://immutant.org/news/tags/thedeuce/">thedeuce</a>
                </span>
                <span class="tag tag-1">
                  <a href="http://immutant.org/news/tags/torquebox/">torquebox</a>
                </span>
                <span class="tag tag-0">
                  <a href="http://immutant.org/news/tags/transactions/">transactions</a>
                </span>
                <span class="tag tag-0">
                  <a href="http://immutant.org/news/tags/transit/">transit</a>
                </span>
                <span class="tag tag-2">
                  <a href="http://immutant.org/news/tags/tutorial/">tutorial</a>
                </span>
                <span class="tag tag-0">
                  <a href="http://immutant.org/news/tags/under-the-hood/">under-the-hood</a>
                </span>
                <span class="tag tag-1">
                  <a href="http://immutant.org/news/tags/vertx/">vertx</a>
                </span>
                <span class="tag tag-1">
                  <a href="http://immutant.org/news/tags/web/">web</a>
                </span>
                <span class="tag tag-1">
                  <a href="http://immutant.org/news/tags/websockets/">websockets</a>
                </span>
                <span class="tag tag-1">
                  <a href="http://immutant.org/news/tags/wildfly/">wildfly</a>
                </span>
                <span class="tag tag-1">
                  <a href="http://immutant.org/news/tags/wtf/">wtf</a>
                </span>
                <span class="tag tag-0">
                  <a href="http://immutant.org/news/tags/xa/">xa</a>
                </span>
              </div>
            </div>
          </div>
        </div>
      </div>
      <div id="footer-push"></div>
    </div>
    <div id="footer">
      <div class="container">
        <div class="row" id="bottom-nav">
          <div class="span8">
            <div id="legal">
              <p>The Immutant project is a member of the <a href="http://jboss.org/">JBoss
              Community</a> and produced by the
              <a href="http://projectodd.org/">Project:odd</a> team.  It is a
              community-driven open-source project, and is licensed under
              the <a href="/license-lgpl.txt">GNU LGPL</a> or <a href="/license-asl.txt">Apache Software
              License</a>, depending on the version.</p>
              
              <p>Copyright 2011 - 2017 <a href="http://redhat.com/">Red Hat, Inc.</a>
              Immutant&trade; is a trademark of Red Hat, Inc.</p>
              
              <p>Content licensed under <a href="http://creativecommons.org/licenses/by-sa/4.0/">CC BY-SA 4.0</a>.</p>
            </div>
          </div>
          <div class="span4">
            <div id="badges">
              <a href="http://jboss.org/"><img id="jbosscommunity-logo" src="http://torquebox.org/images/jbosscommunity-logo.png"></a>
              <a href="http://projectodd.org/"><img id="projectodd-logo" src="http://projectodd.org/images/projectodd-logo.png"></a>
            </div>
          </div>
        </div>
      </div>
    </div>
    <script src="/javascripts/bootstrap-collapse.js" type="text/javascript"></script>
    <script src="/javascripts/bootstrap-dropdown.js" type="text/javascript"></script>
    <script src="/javascripts/bootstrap-tab.js" type="text/javascript"></script>
    <script>
      $( function () {
         var syntax_root = "/javascripts/jquery-syntax/"
      
         if (!$.browser.msie && $( '.syntax' ).length) {
           $.getScript( syntax_root + "jquery.syntax.min.js", function () {
             $.syntax( {root: syntax_root,
                       blockLayout: 'plain'} )
           } )
         }
       } )
    </script>
    <script>
    (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
    (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
    m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
    })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
    ga('create', 'UA-6435340-7', 'auto');
    ga('send', 'pageview');
    </script>
  </body>
</html>
